"use strict";(function(){var _pGlob={};_pGlob.objCache={};_pGlob.fadeAnnotations=true;_pGlob.objClickCallbacks=[];_pGlob.pickedObject='';_pGlob.objHoverCallbacks=[];_pGlob.hoveredObject='';_pGlob.objMovementInfos={};_pGlob.objDragOverCallbacks=[];_pGlob.objDragOverInfoByBlock={}
_pGlob.dragMoveOrigins={};_pGlob.dragScaleOrigins={};_pGlob.mediaElements={};_pGlob.loadedFiles={};_pGlob.loadedFile='';_pGlob.animMixerCallbacks=[];_pGlob.arHitPoint=new v3d.Vector3(0,0,0);_pGlob.states=[];_pGlob.percentage=0;_pGlob.animateParamUpdate=null;_pGlob.openedFile='';_pGlob.xrSessionAcquired=false;_pGlob.xrSessionCallbacks=[];_pGlob.screenCoords=new v3d.Vector2();_pGlob.AXIS_X=new v3d.Vector3(1,0,0);_pGlob.AXIS_Y=new v3d.Vector3(0,1,0);_pGlob.AXIS_Z=new v3d.Vector3(0,0,1);_pGlob.MIN_DRAG_SCALE=10e-4;_pGlob.vec2Tmp=new v3d.Vector2();_pGlob.vec2Tmp2=new v3d.Vector2();_pGlob.vec3Tmp=new v3d.Vector3();_pGlob.vec3Tmp2=new v3d.Vector3();_pGlob.quatTmp=new v3d.Quaternion();_pGlob.quatTmp2=new v3d.Quaternion();_pGlob.mat4Tmp=new v3d.Matrix4();_pGlob.planeTmp=new v3d.Plane();_pGlob.raycasterTmp=new v3d.Raycaster();_pGlob.timers={};var _pPhysics={};_pPhysics.syncList=[];_pPhysics.collisionData=[];_pPhysics.collisionInfo={objectA:'',objectB:'',distance:0,positionOnA:[0,0,0],positionOnB:[0,0,0],normalOnB:[0,0,0]};var PL=v3d.PL=v3d.PL||{};PL.legacyMode=false;PL.execInitPuzzles=function(){var _initGlob={};_initGlob.percentage=0;_initGlob.output={initOptions:{fadeAnnotations:true,useBkgTransp:false,preserveDrawBuf:false,useCompAssets:false,useFullscreen:true,useCustomPreloader:false,preloaderStartCb:function(){},preloaderProgressCb:function(){},preloaderEndCb:function(){},}}
var color;function getElements(ids,isParent){var elems=[];if(Array.isArray(ids)&&ids[0]!="WINDOW"&&ids[0]!="DOCUMENT"&&ids[0]!="BODY"){for(var i=0;i<ids.length;i++)
elems.push(getElement(ids[i],isParent));}else{elems.push(getElement(ids,isParent));}
return elems;}
function getElement(id,isParent){var elem;if(Array.isArray(id)&&id[0]=="WINDOW"){if(isParent)
elem=parent;else
elem=window;}else if(Array.isArray(id)&&id[0]=="DOCUMENT"){if(isParent)
elem=parent.document;else
elem=document;}else if(Array.isArray(id)&&id[0]=="BODY"){if(isParent)
elem=parent.document.body;else
elem=document.body;}else{if(isParent)
elem=parent.document.getElementById(id);else
elem=document.getElementById(id);}
return elem;}
function setHTMLElemAttribute(attr,value,ids,isParent){var elems=getElements(ids,isParent);for(var i=0;i<elems.length;i++){var elem=elems[i];if(!elem)
continue;elem[attr]=value;}}
function setHTMLElemStyle(prop,value,ids,isParent){var elems=getElements(ids,isParent);for(var i=0;i<elems.length;i++){var elem=elems[i];if(!elem||!elem.style)
continue;elem.style[prop]=value;}}
function registerSetTimeout(timeout,callback){window.setTimeout(callback,1000*timeout);}
_initGlob.output.initOptions.fadeAnnotations=true;_initGlob.output.initOptions.useBkgTransp=false;_initGlob.output.initOptions.preserveDrawBuf=false;_initGlob.output.initOptions.useCompAssets=true;_initGlob.output.initOptions.useFullscreen=false;_initGlob.output.initOptions.useCustomPreloader=true;_initGlob.output.initOptions.preloaderStartCb=function(){_initGlob.percentage=0;(function(){})();};_initGlob.output.initOptions.preloaderProgressCb=function(percentage){_initGlob.percentage=percentage;(function(){setHTMLElemAttribute('innerHTML',String(Math.round(_initGlob.percentage))+String('%'),'Loading_Percentage',true);setHTMLElemStyle('width',String(Math.round(_initGlob.percentage))+String('%'),'Red_Apple',true);})();};_initGlob.output.initOptions.preloaderEndCb=function(){_initGlob.percentage=100;(function(){registerSetTimeout(0.5,function(){setHTMLElemStyle('display','none','Progress_Bar',true);setHTMLElemStyle('visibility','hidden','Buttons',true);setHTMLElemStyle('visibility','hidden','Buttons1',true);setHTMLElemStyle('visibility','hidden','Buttons2',true);});})();};return _initGlob.output;}
PL.init=function(appInstance,initOptions){initOptions=initOptions||{};if('fadeAnnotations'in initOptions){_pGlob.fadeAnnotations=initOptions.fadeAnnotations;}
var stat_view_TPS,camDir,lv_local,scor_local,tm_local,lg_local,cr_char,previ,stat_previ_st_clear_local,list_buildings,stat_view_FPS,is_selected_char_amazon,is_selected_char_hunter,charDir,stat_change_char,current_pos_Z_fps,stat_view_orbit,person_position,cam_pos_z,pos_cam_x,move_steps,stat_cam_go_down,pos_cam_y,person_position_next,current_level,current_score,time_full,current_lang,stat_game_finised,current_char,cam_pos_z_min,orbit_prepos_x,person_position_prev,cam_pos_z_max,orbit_prepos_y,start_game,stat_mobile_device,stat_jump,stat_girando_lef_right,score,stat_move_right,time,stat_move_left,emptys_witch_fruits,stat_mov_front,emptys_distance,casset_loaded,stat_move_back,fruits_count,stat_giro_left,fruits_amount,stat_giro_right,stat_previ_storage_clear,fruits_max,stat_attack,char_velocity_speed,stat_idle,i,cam_rotation_x,selectable_list_chars,cam_rotation_y,amazon_loaded,cam_rotation_z,hunter_loaded,pick_loaded,stat_bajando_fps_jump,stat_storage_previ,stat_restablecido_fps_jump,current_level_loaded,person_position_Z,levels,pos_cam_z,level_path,current_level_index,final_level,score_min_for_nex_level,person_position_reset,cam_rot_reset,scene_change_char_loaded,stat_game_paused,scenes_change_char,sound_list_temes,movementX,person_rotation_z,teclapulsada,giro_left_o_right,stat_pt_lock_js,person_position_X,person_position_Y,stat_show_controls_touch3,stat_show_controls_touch,stat_show_controls_touch2,stat_show_controls_touch1,stat_show_f01,stat_en_pte,view,stat_view,person_position_current,stat_cheats_menu,j,emptys_to_check,person_rotation_X,score_local,person_rotation_Y,lang,pos_cam_lock_X,pos_cam_lock_Y,pos_cam_lock_Z,rot_cam_lock_x,rot_cam_lock_Y,right_giro_mouse,left_giro_mouse,st_tch_rght,st_tch_up,st_tch_left,st_tch_down,st_tch_jump,st_tch_attack,st_tch_TPS,st_tch_FPS,st_tch_orbit,st_tch_fly,st_tch_r_giro,st_tch_l_giro,stat_fly,page_help,stat_clear_storage,stat_show_f02,scene_main_loaded,count_cheats_access,m,current_path_level,add_time,add_score,index,random_number,clonedSphere,k,fruit_clone,emptys_reorientats,sound_positional,sound_listener,sound_casset,level_local,time_local,lang_local,current_position_X,current_position_Y,current_position_Z,current_char_local,current_level_local,current_lang_local,current_time_local,current_score_local,current_time,level_selected;function initObjectPicking(callback,eventType,mouseDownUseTouchStart){var elem=appInstance.container;elem.addEventListener(eventType,pickListener);if(eventType=="mousedown"){var touchEventName=mouseDownUseTouchStart?"touchstart":"touchend";elem.addEventListener(touchEventName,pickListener);}
var raycaster=new v3d.Raycaster();function pickListener(event){event.preventDefault();var xNorm=0,yNorm=0;if(event instanceof MouseEvent){xNorm=event.offsetX/elem.clientWidth;yNorm=event.offsetY/elem.clientHeight;}else if(event instanceof TouchEvent){var rect=elem.getBoundingClientRect();xNorm=(event.changedTouches[0].clientX-rect.left)/rect.width;yNorm=(event.changedTouches[0].clientY-rect.top)/rect.height;}
_pGlob.screenCoords.x=xNorm*2-1;_pGlob.screenCoords.y=-yNorm*2+1;raycaster.setFromCamera(_pGlob.screenCoords,appInstance.camera);var objList=[];appInstance.scene.traverse(function(obj){objList.push(obj);});var intersects=raycaster.intersectObjects(objList);if(intersects.length>0){var obj=intersects[0].object;callback(obj,event);}else{callback(null,event);}}}
function fireObjectPickingCallbacks(objName,source,index,cbParam){for(var i=0;i<source.length;i++){var cb=source[i];if(objectsIncludeObj([cb[0]],objName)){cb[index](cbParam);}}}
function objectsIncludeObj(objNames,testedObjName){if(!testedObjName)return false;for(var i=0;i<objNames.length;i++){if(testedObjName==objNames[i]){return true;}else{var obj=getObjectByName(objNames[i]);if(obj&&obj.type=="Group"){for(var j=0;j<obj.children.length;j++){if(testedObjName==obj.children[j].name){return true;}}}}}
return false;}
function getPickedObjectName(obj){if(obj.isMesh&&obj.isMaterialGeneratedMesh&&obj.parent){return obj.parent.name;}else{return obj.name;}}
function retrieveObjectNames(objNames){var acc=[];retrieveObjectNamesAcc(objNames,acc);return acc;}
function retrieveObjectNamesAcc(currObjNames,acc){if(typeof currObjNames=="string"){acc.push(currObjNames);}else if(Array.isArray(currObjNames)&&currObjNames[0]=="GROUP"){var newObj=getObjectNamesByGroupName(currObjNames[1]);for(var i=0;i<newObj.length;i++)
acc.push(newObj[i]);}else if(Array.isArray(currObjNames)&&currObjNames[0]=="ALL_OBJECTS"){var newObj=getAllObjectNames();for(var i=0;i<newObj.length;i++)
acc.push(newObj[i]);}else if(Array.isArray(currObjNames)){for(var i=0;i<currObjNames.length;i++)
retrieveObjectNamesAcc(currObjNames[i],acc);}}
function getObjectByName(objName){var objFound;var runTime=typeof _pGlob!="undefined";objFound=runTime?_pGlob.objCache[objName]:null;if(objFound&&objFound.name==objName)
return objFound;appInstance.scene.traverse(function(obj){if(!objFound&&notIgnoredObj(obj)&&(obj.name==objName)){objFound=obj;if(runTime)
_pGlob.objCache[objName]=objFound;}});return objFound;}
function getObjectNamesByGroupName(targetGroupName){var objNameList=[];appInstance.scene.traverse(function(obj){if(notIgnoredObj(obj)){var groupNames=obj.groupNames;if(!groupNames)
return;for(var i=0;i<groupNames.length;i++){var groupName=groupNames[i];if(groupName==targetGroupName){objNameList.push(obj.name);}}}});return objNameList;}
function notIgnoredObj(obj){return(obj.type!="Scene"&&obj.type!="AmbientLight"&&obj.name!=""&&!(obj.isMesh&&obj.isMaterialGeneratedMesh));}
function getAllObjectNames(){var objNameList=[];appInstance.scene.traverse(function(obj){if(notIgnoredObj(obj))
objNameList.push(obj.name)});return objNameList;}
function swizzleValueSign(newAxis,value){newAxis=newAxis.toLowerCase();if(newAxis=='z'){if(typeof value=='number')
return-value
else if(typeof value=='string'&&value!=''&&value!="''"&&value!='""')
return String(-Number(value));else
return value;}else
return value;}
function swizzleVec3(vec,isScale){var dest=[]
dest[0]=vec[0];dest[1]=vec[2];dest[2]=isScale?vec[1]:swizzleValueSign('z',vec[1])
return dest;}
function changeVis(objNames,bool){objNames=retrieveObjectNames(objNames);if(!objNames)
return;for(var i=0;i<objNames.length;i++){var objName=objNames[i]
if(!objName)
continue;var obj=getObjectByName(objName);if(!obj)
continue;obj.visible=bool;}}
function featureAvailable(feature){var userAgent=window.navigator.userAgent;var platform=window.navigator.platform;switch(feature){case'LINUX':return/Linux/.test(platform);case'WINDOWS':return['Win32','Win64','Windows','WinCE'].indexOf(platform)!==-1;case'MACOS':return['Macintosh','MacIntel','MacPPC','Mac68K'].indexOf(platform)!==-1;case'IOS':return(/iPad|iPhone|iPod/.test(userAgent)&&!window.MSStream);case'ANDROID':return/Android/i.test(userAgent);case'MOBILE':return/Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(userAgent);case'CHROME':return(!!window.chrome&&!/Edge/.test(navigator.userAgent));case'FIREFOX':return/Firefox/.test(navigator.userAgent);case'IE':return/Trident/.test(navigator.userAgent);case'EDGE':return/Edge/.test(navigator.userAgent);case'SAFARI':return(/Safari/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent));case'TOUCH':return!!(('ontouchstart'in window)||window.DocumentTouch&&document instanceof DocumentTouch);case'RETINA':return window.devicePixelRatio>=2;case'HDR':return appInstance.useHDR;case'WEBGL2':var canvas=document.createElement('canvas');var gl=canvas.getContext('webgl2')
return!!gl;default:return false;}}
function getElements(ids,isParent){var elems=[];if(Array.isArray(ids)&&ids[0]!="WINDOW"&&ids[0]!="DOCUMENT"&&ids[0]!="BODY"){for(var i=0;i<ids.length;i++)
elems.push(getElement(ids[i],isParent));}else{elems.push(getElement(ids,isParent));}
return elems;}
function getElement(id,isParent){var elem;if(Array.isArray(id)&&id[0]=="WINDOW"){if(isParent)
elem=parent;else
elem=window;}else if(Array.isArray(id)&&id[0]=="DOCUMENT"){if(isParent)
elem=parent.document;else
elem=document;}else if(Array.isArray(id)&&id[0]=="BODY"){if(isParent)
elem=parent.document.body;else
elem=document.body;}else{if(isParent)
elem=parent.document.getElementById(id);else
elem=document.getElementById(id);}
return elem;}
function setHTMLElemStyle(prop,value,ids,isParent){var elems=getElements(ids,isParent);for(var i=0;i<elems.length;i++){var elem=elems[i];if(!elem||!elem.style)
continue;elem.style[prop]=value;}}
function getSceneByAction(action){var root=action.getRoot();var scene=root.type=="Scene"?root:null;root.traverseAncestors(function(ancObj){if(ancObj.type=="Scene"){scene=ancObj;}});return scene;}
function getSceneAnimFrameRate(scene){if(scene&&"v3d"in scene.userData&&"animFrameRate"in scene.userData.v3d){return scene.userData.v3d.animFrameRate;}
return 24;}
var initAnimationMixer=function(){function onMixerFinished(e){var cb=_pGlob.animMixerCallbacks;var found=[];for(var i=0;i<cb.length;i++){if(cb[i][0]==e.action){cb[i][0]=null;found.push(cb[i][1]);}}
for(var i=0;i<found.length;i++){found[i]();}}
return function initAnimationMixer(){if(appInstance.mixer&&!appInstance.mixer.hasEventListener('finished',onMixerFinished))
appInstance.mixer.addEventListener('finished',onMixerFinished);};}();function operateAnimation(operation,animations,from,to,loop,speed,callback,isPlayAnimCompat,rev){if(!animations)
return;if(typeof animations=="string")
animations=[animations];function processAnimation(animName){var action=v3d.SceneUtils.getAnimationActionByName(appInstance,animName);if(!action)
return;switch(operation){case"PLAY":if(!action.isRunning()){action.reset();if(loop&&(loop!="AUTO"))
action.loop=v3d[loop];var scene=getSceneByAction(action);var frameRate=getSceneAnimFrameRate(scene);if(!isPlayAnimCompat){action.repetitions=Infinity;}
var timeScale=Math.abs(parseFloat(speed));if(rev)
timeScale*=-1;action.timeScale=timeScale;action.timeStart=from!==null?from/frameRate:0;if(to!==null){action.getClip().duration=to/frameRate;}else{action.getClip().resetDuration();}
action.time=timeScale>=0?action.timeStart:action.getClip().duration;action.paused=false;action.play();var callbacks=_pGlob.animMixerCallbacks;var found=false;for(var j=0;j<callbacks.length;j++)
if(callbacks[j][0]==action&&callbacks[j][1]==callback)
found=true;if(!found)
_pGlob.animMixerCallbacks.push([action,callback]);}
break;case"STOP":action.stop();var callbacks=_pGlob.animMixerCallbacks;for(var j=0;j<callbacks.length;j++)
if(callbacks[j][0]==action){callbacks.splice(j,1);j--}
break;case"PAUSE":action.paused=true;break;case"RESUME":action.paused=false;break;case"SET_FRAME":var frameRate=getSceneAnimFrameRate(scene);action.time=from?from/frameRate:0;action.play();action.paused=true;break;}}
for(var i=0;i<animations.length;i++){var animName=animations[i];if(animName)
processAnimation(animName);}
initAnimationMixer();}
function setHTMLElemAttribute(attr,value,ids,isParent){var elems=getElements(ids,isParent);for(var i=0;i<elems.length;i++){var elem=elems[i];if(!elem)
continue;elem[attr]=value;}}
function snapBody(objName,targetObjName){if(!objName||!targetObjName)
return;var obj=getObjectByName(objName);var targetObj=getObjectByName(targetObjName);if(!obj||!targetObj)
return;for(var i=0;i<_pPhysics.syncList.length;i++){var syncData=_pPhysics.syncList[i];if(syncData.obj==obj){obj.copyTransform(targetObj);var pos=obj.getWorldPosition(_pGlob.vec3Tmp);var quat=obj.getWorldQuaternion(_pGlob.quatTmp);_pPhysics.transTmp.setIdentity();_pPhysics.transTmp.setOrigin(new Ammo.btVector3(pos.x,pos.y,pos.z));_pPhysics.transTmp.setRotation(new Ammo.btQuaternion(quat.x,quat.y,quat.z,quat.w));syncData.body.setWorldTransform(_pPhysics.transTmp);}}}
function main_game(){stat_change_char=0;if(is_selected_char_hunter){changeVis("select_h",false);changeVis("select_a",false);load_hunter_char();}else if(is_selected_char_amazon){changeVis("select_a",false);changeVis("select_h",false);load_amazon_char();}
hide_body_amazon();hide_body_hunter();hide_body_hunter_fps();if(featureAvailable("MOBILE")){stat_mobile_device=1;console.log('estamos en un dispositivo movil');}
show_controls();hide_button_startout_game();console.log('desactivamos pointerlock realmente ya lo esta activado o visible y z-index 9999 a no ser que iniciemos en mobil');show_controls();show_main_game_stats();show_pick_objs();show_game_menu_calling();setHTMLElemStyle('display','block','fullscreen_button',true);time=time_full;operateAnimation("STOP","hunter_rig",null,null,'AUTO',1,function(){},undefined,false);setHTMLElemAttribute('innerHTML',time,'Time',true);stat_idle=0;start_game=1;stat_view_TPS=1;console.log('deberia haberse reorientado y cambiar a TPS');snapBody("hunter_physic","person_pos_0");}
function createPhysicsBody(type,objNames,shape,mass){objNames=retrieveObjectNames(objNames);if(!objNames)
return;objNames.forEach(function(objName){if(!objName)
return;var obj=getObjectByName(objName);if(!obj)
return;if(type=='STATIC'||type=='KINEMATIC')
mass=0;switch(shape){case'BOX':var size=new v3d.Vector3(1,1,1);if(obj.geometry){if(obj.geometry.boundingBox==null)
obj.geometry.computeBoundingBox();obj.geometry.boundingBox.getSize(size);}
var geometry=new Ammo.btBoxShape(new Ammo.btVector3(size.x*0.5,size.y*0.5,size.z*0.5));break;case'SPHERE':var radius=1;if(obj.geometry){if(obj.geometry.boundingSphere===null)
obj.geometry.computeBoundingSphere();radius=obj.geometry.boundingSphere.radius;}
var geometry=new Ammo.btSphereShape(radius);break;case'MESH':if(!obj.geometry||!obj.isMesh){console.error('create physics body: incorrect mesh object');var geometry=new Ammo.btEmptyShape();break;}
var positions=obj.geometry.attributes.position.array;if(type=='DYNAMIC'){var geometry=new Ammo.btConvexHullShape();for(var i=0;i<positions.length;i+=3){var x=positions[i];var y=positions[i+1];var z=positions[i+2];var v=new Ammo.btVector3(x,y,z);geometry.addPoint(v);Ammo.destroy(v);}}else{var indices=obj.geometry.index.array;var triIdxVertArray=new Ammo.btTriangleMesh();for(var i=0;i<indices.length;i+=3){var i1=indices[i];var i2=indices[i+1];var i3=indices[i+2];var v1=new Ammo.btVector3(positions[3*i1],positions[3*i1+1],positions[3*i1+2]);var v2=new Ammo.btVector3(positions[3*i2],positions[3*i2+1],positions[3*i2+2]);var v3=new Ammo.btVector3(positions[3*i3],positions[3*i3+1],positions[3*i3+2]);triIdxVertArray.addTriangle(v1,v2,v3,false);Ammo.destroy(v1);Ammo.destroy(v2);Ammo.destroy(v3);}
var geometry=new Ammo.btBvhTriangleMeshShape(triIdxVertArray,true);}
break;}
var pos=obj.getWorldPosition(_pGlob.vec3Tmp);var quat=obj.getWorldQuaternion(_pGlob.quatTmp);var transform=new Ammo.btTransform();transform.setIdentity();transform.setOrigin(new Ammo.btVector3(pos.x,pos.y,pos.z));transform.setRotation(new Ammo.btQuaternion(quat.x,quat.y,quat.z,quat.w));var motionState=new Ammo.btDefaultMotionState(transform);var localInertia=new Ammo.btVector3(0,0,0);geometry.calculateLocalInertia(mass,localInertia);var rbInfo=new Ammo.btRigidBodyConstructionInfo(mass,motionState,geometry,localInertia);var body=new Ammo.btRigidBody(rbInfo);if(type=='KINEMATIC'){var CF_KINEMATIC_OBJECT=2;body.setCollisionFlags(body.getCollisionFlags()|CF_KINEMATIC_OBJECT);}
_pPhysics.world.addRigidBody(body);_pPhysics.syncList.push({obj:obj,body:body,type:type});});}
function physicsBodyParams(objNames,friction,linearDamping,angularDamping,restitution){objNames=retrieveObjectNames(objNames);if(!objNames)
return;objNames.forEach(function(objName){if(!objName)
return;var obj=getObjectByName(objName);if(!obj)
return;for(var i=0;i<_pPhysics.syncList.length;i++){var syncData=_pPhysics.syncList[i];if(syncData.obj==obj){syncData.body.setFriction(friction);syncData.body.setDamping(linearDamping,angularDamping);syncData.body.setRestitution(restitution);}}});}
function init_physics(){createPhysicsBody("STATIC","road_collision","MESH",1);createPhysicsBody("STATIC","paredes o balla parque","MESH",1);createPhysicsBody("STATIC","parque_ road_collision","MESH",1);createPhysicsBody("STATIC","cera parque collision","MESH",1);createPhysicsBody("DYNAMIC","hunter_physic","BOX",1);physicsBodyParams("hunter_physic",0.9,0.5,0.2,0);}
function storage_get_level_parameters_cb(lv_local,scor_local,tm_local,lg_local,cr_char,previ,stat_previ_st_clear_local){console.log('se ha ejecutado un click por detectar storage previo');console.log('ahora si clear storage esta cheked siempre ');console.log('forzara a que change char se lance');stat_previ_storage_clear=stat_previ_st_clear_local;console.log('se usa en game menu cheat para activar check');current_level=lv_local;current_score=scor_local;time_full=tm_local;current_lang=lg_local;current_char=cr_char;stat_storage_previ=previ;if(current_char=='amazon'){is_selected_char_amazon=1;}else if(current_char=='hunter'){is_selected_char_hunter=1;}else{is_selected_char_hunter=1;}
main_game();}
appInstance.ExternalInterface["storage_get_level_parameters_cb"]=storage_get_level_parameters_cb;function getJSFunction(funcName){var jsFunc=appInstance.ExternalInterface[funcName];if(typeof jsFunc=="function")
return jsFunc;else
return function(){};}
function update_app_vars(){getJSFunction('store_init_cb')(current_level,current_score,time_full,current_lang,stat_game_finised,current_char,stat_change_char);}
function setup_control_mouse(movementX){if(stat_view_FPS){if(movementX>0){giro_left_o_right=0.01;}else if(movementX<0){giro_left_o_right=-0.01;}else if(movementX==0){giro_left_o_right=0;}}
if(stat_girando_lef_right){giro_left_o_right=movementX;}}
appInstance.ExternalInterface["setup_control_mouse"]=setup_control_mouse;function eventHTMLElem(eventType,ids,isParent,callback){var elems=getElements(ids,isParent);for(var i=0;i<elems.length;i++){var elem=elems[i];if(!elem)
continue;elem.addEventListener(eventType,callback,false);}}
function getEventProperty(prop,event){if(typeof event!="undefined"){if(prop=="target.id")
return event.target.id;else
return event[prop];}}
function setActiveCamera(camName){var camera=getObjectByName(camName);if(!camera||!camera.isCamera||appInstance.camera==camera)
return;appInstance.setCamera(camera);}
function tweenCamera(posObjName,targetObjName,duration,doSlot){if(!targetObjName)
return;if(posObjName)
var posObj=getObjectByName(posObjName);else
var posObj=appInstance.camera;var targetObj=getObjectByName(targetObjName);if(!posObj||!targetObj)
return;var wPos=posObj.getWorldPosition(_pGlob.vec3Tmp);var wTarget=targetObj.getWorldPosition(_pGlob.vec3Tmp2);if(appInstance.controls&&appInstance.controls.tween){if(!appInstance.controls.inTween)
appInstance.controls.tween(wPos,wTarget,duration,doSlot);}else{if(appInstance.camera.parent)
appInstance.camera.parent.worldToLocal(wPos);appInstance.camera.position.copy(wPos);appInstance.camera.lookAt(wTarget);doSlot();}}
function snapToObject(objName,targetObjName){if(!objName||!targetObjName)
return;var obj=getObjectByName(objName);var targetObj=getObjectByName(targetObjName);if(!obj||!targetObj)
return;obj.copyTransform(targetObj);obj.updateMatrixWorld(true);}
function getObjTransform(objName,mode,coord){if(!objName)
return;var obj=getObjectByName(objName);if(!obj)
return;if(mode=="rotation")
return swizzleValueSign(coord,obj[mode][coord]*180/Math.PI);else if(mode=='position')
return swizzleValueSign(coord,obj[mode][coord]);else
return obj[mode][coord];}
function registerInterval(timeout,callback){window.setInterval(callback,1000*timeout);}
function game_finised(){console.log('juego ha finalizado');stat_game_finised=1;start_game=0;hide_repes_finalizat();show_game_restart();console.log('current level index se actualiza ej en next level click');current_score=score;time_full=100;current_lang=lang;setHTMLElemStyle('display','block','Final_Scores_Bar',true);setHTMLElemAttribute('innerHTML',score,'Final_Scores',true);operateAnimation("STOP","hunter_rig",null,null,'AUTO',1,function(){},undefined,false);if(current_score>=score_min_for_nex_level){if(!(current_level_index==final_level)){show_nex_level_btn();nivel_siguiente();}else{setHTMLElemStyle('display','block','Comming_Soon',true);console.log('llegamos al ultimo no hay mas');console.log('ahora propongo listar los niveles y que');console.log('decida volver a jugar el que quiera');console.log('por el momento solo mostramos un mensqaje que no hay mas');console.log('o proximamente comming soon saldra otro nivel');}
console.log('nivel superado selecciona siguiente, repite o salir');console.log('nos falta sin duda btn salir pero es la forma ');console.log('de mantenerlos o no es usabilidad? forzar resert');getJSFunction('store_init_cb')(current_level,current_score,time_full,current_lang,stat_game_finised,current_char,stat_change_char);}else{hide_nex_level_btn();}
console.log('si cada restart o exit ejecuta esto next no');console.log('debria hacerlo puesto que se repite');}
function char_status(){if(stat_giro_left==1){stat_idle=0;giro_left2();}else if(stat_giro_right==1){stat_idle=0;giro_right2();}else if(stat_move_left==1){stat_idle=0;move_left2();}else if(stat_move_right==1){stat_idle=0;move_right2();}else if(stat_mov_front==1){stat_idle=0;move_front();}else if(stat_move_back==1){stat_idle=0;move_back();}else if(stat_jump==1){stat_idle=0;move_jump2();}else if(stat_girando_lef_right){girando_lef_right(giro_left_o_right);}else{stat_idle=1;idle2();}}
function setObjTransform(objNames,mode,x,y,z,offset){objNames=retrieveObjectNames(objNames);if(!objNames)return;function setObjProp(obj,prop,val){if(typeof val!="number")
return;if(mode=="rotation")
val=val*Math.PI/180;if(!offset){obj[mode][prop]=val;}else{if(mode!="scale")
obj[mode][prop]+=val;else
obj[mode][prop]*=val;}}
var inVec=swizzleVec3([x,y,z],mode=='scale');x=inVec[0];y=inVec[1];z=inVec[2];for(var i=0;i<objNames.length;i++){var objName=objNames[i];if(!objName)continue;var obj=getObjectByName(objName);if(!obj)continue;setObjProp(obj,"x",x);setObjProp(obj,"y",y);setObjProp(obj,"z",z);obj.updateMatrixWorld(true);}}
function getDistanceBetweenObjects(objName1,objName2){if(!objName1||!objName2)
return;var obj1=getObjectByName(objName1);var obj2=getObjectByName(objName2);if(!obj1||!obj2)
return;return obj1.getWorldPosition(_pGlob.vec3Tmp).distanceTo(obj2.getWorldPosition(_pGlob.vec3Tmp2));}
function registerEveryFrame(callback){if(typeof callback=="function")
appInstance.renderCallbacks.push(callback);}
function physicsApplyVector(type,objNames,x,y,z){objNames=retrieveObjectNames(objNames);if(!objNames)
return;var vec=swizzleVec3([x,y,z]);objNames.forEach(function(objName){if(!objName)
return;var obj=getObjectByName(objName);if(!obj)
return;for(var i=0;i<_pPhysics.syncList.length;i++){var syncData=_pPhysics.syncList[i];if(syncData.obj==obj){var btVec=new Ammo.btVector3(vec[0],vec[1],vec[2]);switch(type){case'GRAVITY':syncData.body.setGravity(btVec);break;case'FORCE':syncData.body.applyCentralForce(btVec);break;case'LINEAR_VELOCITY':syncData.body.setLinearVelocity(btVec);break;case'ANGULAR_VELOCITY':syncData.body.setAngularVelocity(btVec);break;case'IMPULSE':syncData.body.applyCentralImpulse(btVec);break;case'TORQUE':syncData.body.applyTorque(btVec);break;case'TORQUE_IMPULSE':syncData.body.applyTorqueImpulse(btVec);break;case'POSITION':_pPhysics.transTmp.setIdentity();_pPhysics.transTmp.setOrigin(btVec);var quat=obj.quaternion;_pPhysics.transTmp.setRotation(new Ammo.btQuaternion(quat.x,quat.y,quat.z,quat.w));syncData.body.setWorldTransform(_pPhysics.transTmp);break;}
Ammo.destroy(btVec);}}});}
function restore_pos_char(person_position_X,person_position_Y,person_position_Z){stat_view_TPS=1;console.log('seguramente por eso habia un setactive a orbit');console.log('Se ha restablecido poscion character!');console.log('si los datos son correctos tenemos de posicion X');console.log(person_position_X);console.log('e Y position restablecida ');console.log(person_position_Y);console.log('y Z position restablecida ');console.log(person_position_Z);setActiveCamera("Cam_down_ctrl");tweenCamera('',"camera_target",1,function(){});physicsApplyVector("POSITION","hunter_physic",person_position_X,person_position_Y,person_position_Z);setObjTransform("hunter_physic","rotation",0,0,0,true);}
function reset_camera(){cam_rotation_x=0;cam_rotation_y=0;cam_rotation_z=0;}
function removePhysicsBody(objNames){objNames=retrieveObjectNames(objNames);if(!objNames)
return;objNames.forEach(function(objName){if(!objName)
return;var obj=getObjectByName(objName);if(!obj)
return;for(var i=0;i<_pPhysics.syncList.length;i++){var syncData=_pPhysics.syncList[i];if(syncData.obj==obj){_pPhysics.world.removeRigidBody(syncData.body);Ammo.destroy(syncData.body);_pPhysics.syncList.splice(i,1);i--;}}});}
function applyObjLocalTransform(objNames,mode,x,y,z){objNames=retrieveObjectNames(objNames);if(!objNames)return;var defValue=mode=="scale"?1:0;if(typeof x!="number")x=defValue;if(typeof y!="number")y=defValue;if(typeof z!="number")z=defValue;var inVec=swizzleVec3([x,y,z],mode=='scale');for(var i=0;i<objNames.length;i++){var objName=objNames[i];if(!objName)continue;var obj=getObjectByName(objName);if(!obj)continue;var useSwizzled=!obj.isCamera;var xVal=useSwizzled?inVec[0]:x;var yVal=useSwizzled?inVec[1]:y;var zVal=useSwizzled?inVec[2]:z;switch(mode){case"position":if(_pGlob.xrSessionAcquired&&obj.isCamera){v3d.WebVRUtils.translateVRCamera(obj,_pGlob.AXIS_X,xVal);v3d.WebVRUtils.translateVRCamera(obj,_pGlob.AXIS_Y,yVal);v3d.WebVRUtils.translateVRCamera(obj,_pGlob.AXIS_Z,zVal);}else{obj.translateX(xVal);obj.translateY(yVal);obj.translateZ(zVal);}
break;case"rotation":if(_pGlob.xrSessionAcquired&&obj.isCamera){v3d.WebVRUtils.rotateVRCamera(obj,_pGlob.AXIS_X,v3d.Math.degToRad(xVal));v3d.WebVRUtils.rotateVRCamera(obj,_pGlob.AXIS_Y,v3d.Math.degToRad(yVal));v3d.WebVRUtils.rotateVRCamera(obj,_pGlob.AXIS_Z,v3d.Math.degToRad(zVal));}else{obj.rotateX(v3d.Math.degToRad(xVal));obj.rotateY(v3d.Math.degToRad(yVal));obj.rotateZ(v3d.Math.degToRad(zVal));}
break;case"scale":obj.scale.x*=xVal;obj.scale.y*=yVal;obj.scale.z*=zVal;break;}
obj.updateMatrixWorld(true);}}
function reset_rot_character(){if(stat_view_TPS==1&&person_position_reset){console.log('rotacion actual char tps');console.log(getObjTransform("hunter_physic","rotation","x"));console.log(getObjTransform("hunter_physic","rotation","z"));console.log(getObjTransform("hunter_physic","rotation","y"));console.log('rotacion del person_pos_0');console.log(getObjTransform("person_pos_0","rotation","x"));console.log(getObjTransform("person_pos_0","rotation","z"));console.log(getObjTransform("person_pos_0","rotation","y"));person_rotation_X=getObjTransform("hunter_physic","rotation","x");person_rotation_Y=getObjTransform("hunter_physic","rotation","z");person_rotation_z=getObjTransform("hunter_physic","rotation","y");removePhysicsBody("hunter_physic");applyObjLocalTransform("hunter_physic","rotation",-1*person_rotation_X,-1*person_rotation_Y,7.5);createPhysicsBody("DYNAMIC","hunter_physic","BOX",1);physicsBodyParams("hunter_physic",0.7,0.5,0.2,0);console.log(getObjTransform("hunter_physic","rotation","x"));console.log(getObjTransform("hunter_physic","rotation","z"));console.log(getObjTransform("hunter_physic","rotation","y"));}else if(stat_view_FPS&&cam_rot_reset==1){reset_camera();console.log('Se ha reorientado up supuestamente la camera');cam_rot_reset=0;}}
function isAnimationPlaying(animations){if(!animations)
return;if(typeof animations=="string")
animations=[animations];for(var i=0;i<animations.length;i++){var animName=animations[i];if(!animName)
continue;var action=v3d.SceneUtils.getAnimationActionByName(appInstance,animName);if(action&&action.isRunning())
return true;}
return false;}
function show_run_tool(){setHTMLElemStyle('display','block','Run_Tool',true);setHTMLElemStyle('zIndex','2','Run_Tool',true);setHTMLElemStyle('visibility','visible','Canvas_Shadow',true);}
function initFullscreen(id,isParent,cb_enter,cb_exit,cb_unavail){var elem=getElement(id,isParent);if(!elem)
return;var doc=isParent?parent.document:document;if(!(doc.fullscreenEnabled||doc.webkitFullscreenEnabled||doc.mozFullScreenEnabled||doc.msFullscreenEnabled)){cb_unavail();return;}
elem.addEventListener("click",function(event){event.stopPropagation();if(doc.fullscreenElement||doc.webkitFullscreenElement||doc.mozFullScreenElement||doc.msFullscreenElement){exitFullscreen();}else{requestFullscreen(doc.body);}});function changeFullscreen(){if(doc.fullscreenElement||doc.webkitFullscreenElement||doc.mozFullScreenElement||doc.msFullscreenElement)
cb_enter();else
cb_exit();}
doc.addEventListener("webkitfullscreenchange",changeFullscreen);doc.addEventListener("mozfullscreenchange",changeFullscreen);doc.addEventListener("msfullscreenchange",changeFullscreen);doc.addEventListener("fullscreenchange",changeFullscreen);function requestFullscreen(fselem){if(fselem.requestFullscreen)
fselem.requestFullscreen();else if(fselem.mozRequestFullScreen)
fselem.mozRequestFullScreen();else if(fselem.webkitRequestFullscreen)
fselem.webkitRequestFullscreen();else if(fselem.msRequestFullscreen)
fselem.msRequestFullscreen();}
function exitFullscreen(){if(doc.exitFullscreen)
doc.exitFullscreen();else if(doc.mozCancelFullScreen)
doc.mozCancelFullScreen();else if(doc.webkitExitFullscreen)
doc.webkitExitFullscreen();else if(doc.msExitFullscreen)
doc.msExitFullscreen();}}
function hide_run_tool(){setHTMLElemStyle('display','none','Run_Tool',true);setHTMLElemStyle('zIndex','0','Run_Tool',true);setHTMLElemStyle('visibility','hidden','Canvas_Shadow',true);}
function show_button_startout_game(){setHTMLElemStyle('display','block','Locker',true);setHTMLElemStyle('zIndex','2','Locker',true);setHTMLElemStyle('zIndex','2','Top_Left_Bar',true);setHTMLElemStyle('visibility','visible','Canvas_Shadow',true);}
function show_pointer_lock_btn_TPS(){setHTMLElemStyle('visibility','visible','Pointerlock_Elem_TPS',false);setHTMLElemStyle('opacity','1','Pointerlock_Elem_TPS',false);setHTMLElemStyle('zIndex','3','Pointerlock_Elem_TPS',false);setHTMLElemStyle('display','block','Pointerlock_Elem_TPS',false);}
function show_button_select_avatars(){setHTMLElemStyle('display','block','select_avatars',true);setHTMLElemStyle('zIndex','22222','select_avatars',true);setHTMLElemStyle('visibility','visible','select_avatars',true);}
function hide_button_startout_game(){setHTMLElemStyle('display','none','Locker',true);setHTMLElemStyle('zIndex','0','Locker',true);setHTMLElemStyle('zIndex','0','Top_Left_Bar',true);setHTMLElemStyle('visibility','hidden','Canvas_Shadow',true);}
function show_game_restart(){setHTMLElemStyle('visibility','visible','Game_Restart_Dialeg',true);setHTMLElemStyle('opacity','1','Game_Restart_Dialeg',true);setHTMLElemStyle('zIndex','4','Game_Restart_Dialeg',true);}
function hide_button_select_avatars(){setHTMLElemStyle('display','none','select_avatars',true);setHTMLElemStyle('zIndex','0','select_avatars',true);setHTMLElemStyle('visibility','hidden','select_avatars',true);}
function show_pick_objs(){console.log('mostrar pick objects no deberia ocultar call a game menu');setHTMLElemStyle('display','block','Top_Left_Bar',true);setHTMLElemStyle('zIndex','2','Top_Left_Bar',true);}
function show_body_hunter_change(){changeVis("hunter_body_h",true);changeVis("head_hunter_h",true);changeVis("visor2_h",true);changeVis("helmet_h",true);changeVis("select_h",true);}
function hide_game_restart(){setHTMLElemStyle('visibility','hidden','Game_Restart_Dialeg',true);setHTMLElemStyle('opacity','1','Game_Restart_Dialeg',true);setHTMLElemStyle('zIndex','0','Game_Restart_Dialeg',true);}
function hide_pointer_lock_btn_TPS(){setHTMLElemStyle('visibility','hidden','Pointerlock_Elem_TPS',false);setHTMLElemStyle('opacity','1','Pointerlock_Elem_TPS',false);setHTMLElemStyle('zIndex','0','Pointerlock_Elem_TPS',false);setHTMLElemStyle('display','none','Pointerlock_Elem_TPS',false);}
function isObjectVisible(objNames){objNames=retrieveObjectNames(objNames);if(!objNames)
return false;for(var i=0;i<objNames.length;i++){var objName=objNames[i]
if(!objName)
continue;var obj=getObjectByName(objName);if(!obj)
continue;if(obj.visible)
return true;}
return false;}
function show_body_hunter(){if(!isObjectVisible("hunter_body")){changeVis("head_hunter",true);changeVis("hunter_body",true);changeVis("helmet",true);changeVis("hunter_armadura",true);changeVis("hunter_armatue2",true);changeVis("visor2",true);changeVis("mascara_gas",true);changeVis("knife_tps",true);changeVis("knife_tps_funda",true);}}
function hide_pick_objs(){console.log('ocultar pick objects');setHTMLElemStyle('display','none','Top_Left_Bar',true);setHTMLElemStyle('zIndex','0','Top_Left_Bar',true);}
function hide_body_hunter(){changeVis("head_hunter",false);changeVis("hunter_body",false);changeVis("helmet",false);changeVis("hunter_armadura",false);changeVis("hunter_armatue2",false);changeVis("visor2",false);changeVis("mascara_gas",false);changeVis("knife_tps",false);changeVis("knife_tps_funda",false);}
function show_main_game_stats(){setHTMLElemStyle('visibility','visible','Life_Bar',true);setHTMLElemStyle('opacity','1','Life_Bar',true);setHTMLElemStyle('visibility','visible','Control_Save_Current_Stat',false);setHTMLElemStyle('visibility','visible','Control_Load_Previ_Stat',false);}
function hide_body_hunter_change(){changeVis("hunter_body_h",false);changeVis("head_hunter_h",false);changeVis("visor2_h",false);changeVis("helmet_h",false);changeVis("select_h",false);}
function hide_main_game_stats(){setHTMLElemStyle('visibility','hidden','Life_Bar',true);setHTMLElemStyle('opacity','0','Life_Bar',true);setHTMLElemStyle('visibility','hidden','Control_Save_Current_Stat',false);setHTMLElemStyle('visibility','hidden','Control_Load_Previ_Stat',false);}
function show_pointer_lock_btn_FPS(){setHTMLElemStyle('visibility','visible','Pointerlock_Elem_FPS',false);setHTMLElemStyle('opacity','1','Pointerlock_Elem_FPS',false);setHTMLElemStyle('zIndex','3','Pointerlock_Elem_FPS',false);setHTMLElemStyle('display','block','Pointerlock_Elem_FPS',false);}
function show_icon_change_char(){setHTMLElemStyle('visibility','visible','Sound_Id',false);setHTMLElemStyle('opacity','1','Sound_Id',false);setHTMLElemStyle('zIndex','3','Sound_Id',false);setHTMLElemStyle('display','block','Sound_Id',false);}
function show_game_menu_calling(){setHTMLElemStyle('opacity','1','Game_Menu_Calling',true);setHTMLElemStyle('zIndex','2','Game_Menu_Calling',true);setHTMLElemStyle('visibility','visible','Game_Menu_Calling',true);}
function show_body_amazon_change(){changeVis("hunter_body_a",true);changeVis("select_a",true);}
function hide_icon_change_char(){setHTMLElemStyle('visibility','hidden','Sound_Id',false);setHTMLElemStyle('opacity','1','Sound_Id',false);setHTMLElemStyle('zIndex','0','Sound_Id',false);setHTMLElemStyle('display','none','Sound_Id',false);}
function show_body_hunter_fps(){if(!isObjectVisible("hunter_fps_body")){changeVis("sleeves",true);changeVis("hunter_fps_body",true);}}
function hide_pointer_lock_btn_FPS(){setHTMLElemStyle('visibility','hidden','Pointerlock_Elem_FPS',false);setHTMLElemStyle('opacity','1','Pointerlock_Elem_FPS',false);setHTMLElemStyle('zIndex','0','Pointerlock_Elem_FPS',false);setHTMLElemStyle('display','none','Pointerlock_Elem_FPS',false);}
function hide_game_menu_calling(){setHTMLElemStyle('opacity','0','Game_Menu_Calling',true);setHTMLElemStyle('zIndex','0','Game_Menu_Calling',true);setHTMLElemStyle('visibility','hidden','Game_Menu_Calling',true);}
function show_form_f01_change_char_menu(){stat_show_f01=1;setHTMLElemStyle('visibility','visible','F01_Change_Char_Menu',false);setHTMLElemStyle('opacity','1','F01_Change_Char_Menu',false);setHTMLElemStyle('zIndex','3','F01_Change_Char_Menu',false);setHTMLElemStyle('display','block','F01_Change_Char_Menu',false);}
function hide_body_amazon_change(){changeVis("hunter_body_a",false);changeVis("select_a",false);}
function hide_body_hunter_fps(){changeVis("sleeves",false);changeVis("hunter_fps_body",false);}
function show_game_main(){setHTMLElemStyle('visibility','visible','Game_Menu',true);setHTMLElemStyle('visibility','visible','Canvas_Shadow',true);setHTMLElemStyle('zIndex','2','Canvas_Shadow',true);setHTMLElemStyle('zIndex','3','Game_Menu',true);setHTMLElemStyle('opacity','1','Game_Menu',true);}
function hide_form_f01_change_char_menu(){stat_show_f01=0;setHTMLElemStyle('visibility','hidden','F01_Change_Char_Menu',false);setHTMLElemStyle('opacity','1','F01_Change_Char_Menu',false);setHTMLElemStyle('zIndex','0','F01_Change_Char_Menu',false);setHTMLElemStyle('display','none','F01_Change_Char_Menu',false);}
function show_casset(){changeVis("BoomBox",true);}
function hide_help_f2(){setHTMLElemStyle('visibility','hidden','Help_Text2',false);setHTMLElemStyle('opacity','1','Help_Text2',false);setHTMLElemStyle('display','none','Help_Text2',false);setHTMLElemStyle('zIndex','0','Help_Text2',false);}
function show_body_amazon(){changeVis("hunter_body",true);}
function show_help_f2(){setHTMLElemStyle('visibility','visible','Help_Text2',false);setHTMLElemStyle('opacity','1','Help_Text2',false);setHTMLElemStyle('display','block','Help_Text2',false);setHTMLElemStyle('zIndex','4','Help_Text2',false);}
function hide_casset(){changeVis("BoomBox",false);}
function show_game_exit(){setHTMLElemStyle('visibility','visible','Game_Exit_Dialeg',true);setHTMLElemStyle('opacity','1','Game_Exit_Dialeg',true);setHTMLElemStyle('zIndex','4','Game_Exit_Dialeg',true);}
function show_help_f01(){setHTMLElemStyle('visibility','visible','Help_Text',false);setHTMLElemStyle('opacity','1','Help_Text',false);setHTMLElemStyle('zIndex','3','Help_Text',false);setHTMLElemStyle('display','block','Help_Text',false);}
function hide_body_amazon(){changeVis("hunter_body",false);}
function hide_game_main(){setHTMLElemStyle('visibility','hidden','Game_Menu',true);setHTMLElemStyle('visibility','hidden','Canvas_Shadow',true);setHTMLElemStyle('zIndex','0','Canvas_Shadow',true);setHTMLElemStyle('opacity','1','Game_Menu',true);setHTMLElemStyle('zIndex','0','Game_Menu',true);}
function hide_help_f01(){setHTMLElemStyle('visibility','hidden','Help_Text',false);setHTMLElemStyle('opacity','1','Help_Text',false);setHTMLElemStyle('zIndex','0','Help_Text',false);setHTMLElemStyle('display','none','Help_Text',false);}
function show_form_f02_Cheats_menu(){setHTMLElemStyle('visibility','visible','F02_Cheats_Menu',false);setHTMLElemStyle('opacity','1','F02_Cheats_Menu',false);setHTMLElemStyle('display','block','F02_Cheats_Menu',false);setHTMLElemStyle('zIndex','4','F02_Cheats_Menu',false);}
function hide_game_exit(){setHTMLElemStyle('visibility','hidden','Game_Exit_Dialeg',true);setHTMLElemStyle('opacity','1','Game_Exit_Dialeg',true);setHTMLElemStyle('zIndex','0','Game_Exit_Dialeg',true);}
function hide_form_f02_Cheats_menu(){setHTMLElemStyle('visibility','hidden','F02_Cheats_Menu',false);setHTMLElemStyle('opacity','1','F02_Cheats_Menu',false);setHTMLElemStyle('display','none','F02_Cheats_Menu',false);setHTMLElemStyle('zIndex','0','F02_Cheats_Menu',false);}
function hide_game_help(){setHTMLElemStyle('visibility','hidden','Help_Panel',true);setHTMLElemStyle('opacity','1','Help_Panel',true);setHTMLElemStyle('zIndex','0','Help_Panel',true);hide_help_next();hide_help_exit();}
function show_game_help(){setHTMLElemStyle('visibility','visible','Help_Panel',true);setHTMLElemStyle('opacity','1','Help_Panel',true);setHTMLElemStyle('zIndex','4','Help_Panel',true);show_help_next();show_help_exit();}
function hide_help_exit(){setHTMLElemStyle('visibility','hidden','Help_Exit',true);}
function show_help_exit(){setHTMLElemStyle('visibility','visible','Help_Exit',true);}
function hide_help_next(){setHTMLElemStyle('visibility','hidden','Help_Next',true);}
function show_help_next(){setHTMLElemStyle('visibility','visible','Help_Next',true);}
function hide_help_descr(){setHTMLElemStyle('visibility','hidden','Help_Descr',true);}
function show_help_descr(){setHTMLElemStyle('visibility','visible','Help_Descr',true);}
function controls_touch3(){if(!stat_show_controls_touch3){stat_show_controls_touch3=1;hide_controls_touch3();}else if(stat_show_controls_touch3){show_controls_touch3();stat_show_controls_touch3=0;}}
function show_game_credits(){setHTMLElemStyle('visibility','visible','Credits_Panel',true);setHTMLElemStyle('opacity','1','Credits_Panel',true);setHTMLElemStyle('zIndex','4','Credits_Panel',true);}
function hide_game_credits(){setHTMLElemStyle('visibility','hidden','Credits_Panel',true);setHTMLElemStyle('opacity','1','Credits_Panel',true);setHTMLElemStyle('zIndex','0','Credits_Panel',true);}
function Go_ORBIT_TPS(){console.log('se ha dado el click sobre orbit');if(stat_view_TPS==1&&stat_view_orbit==0&&stat_view_FPS==0){setActiveCamera("Cam_orbit");if(is_selected_char_hunter){show_body_hunter();}else if(is_selected_char_amazon){show_body_amazon();}
stat_view_orbit=1;console.log('Se ha camabiado camara a  ORBIT! desde TPS');console.log('luego mantenemos su estado 1 asimilado ');console.log('y no lo cambiamos');}else if(stat_view_FPS==1&&(stat_view_orbit==0||stat_view_TPS==0)){setActiveCamera("Cam_orbit");if(is_selected_char_hunter){show_body_hunter();}else if(is_selected_char_amazon){show_body_amazon();}
hide_body_hunter_fps();stat_view_orbit=1;console.log('Se ha camabiado camara a  ORBIT! desde FPS');stat_view_FPS=0;view='FPS';stat_view=stat_view_FPS;getJSFunction('set_stat_view')(stat_view,view);stat_view_TPS=1;view='TPS';stat_view=stat_view_TPS;getJSFunction('set_stat_view')(stat_view,view);removePhysicsBody("hunter_physic");snapToObject("hunter_physic","pos_FPS");createPhysicsBody("DYNAMIC","hunter_physic","BOX",1);physicsBodyParams("hunter_physic",0.9,0.5,0.2,0);}
hide_controls_touch1();}
function show_controls_touch3(){setHTMLElemStyle('visibility','visible','Control_Main_Menu',true);setHTMLElemStyle('visibility','visible','Control_Fly',true);}
function show_controls(){setHTMLElemStyle('visibility','visible','Controls_Touch3',true);setHTMLElemStyle('visibility','visible','Controls_Touch2',true);setHTMLElemStyle('visibility','visible','Controls_Touch1',true);setHTMLElemStyle('visibility','visible','Controls_Touch',true);}
function hide_controls(){setHTMLElemStyle('visibility','hidden','Controls_Touch3',true);setHTMLElemStyle('visibility','hidden','Controls_Touch2',true);setHTMLElemStyle('visibility','hidden','Controls_Touch1',true);setHTMLElemStyle('visibility','hidden','Controls_Touch',true);}
function hide_controls_touch3(){setHTMLElemStyle('visibility','hidden','Control_Main_Menu',true);setHTMLElemStyle('visibility','hidden','Control_Fly',true);}
function Go_TPS(){if(stat_view_FPS==1&&(stat_view_orbit==0||stat_view_TPS==0)){setActiveCamera("Cam_down_ctrl");removePhysicsBody("hunter_physic");snapToObject("hunter_physic","pos_FPS");createPhysicsBody("DYNAMIC","hunter_physic","BOX",1);physicsBodyParams("hunter_physic",0.8,0.5,0.2,0);stat_view_TPS=1;console.log('Se ha camabiado a camara TPS! desde FPS');stat_view_FPS=0;view='FPS';stat_view=stat_view_FPS;getJSFunction('set_stat_view')(stat_view,view);hide_body_hunter_fps();}else if(stat_view_FPS==0&&(stat_view_TPS==1||stat_view_orbit==1)){setActiveCamera("Cam_down_ctrl");stat_view_TPS=1;console.log('Se ha camabiado camara a TPS! desde ORBIT');stat_view_orbit=0;view='orbit';stat_view=stat_view_orbit;getJSFunction('set_stat_view')(stat_view,view);if(is_selected_char_hunter){show_body_hunter();}else if(is_selected_char_amazon){show_body_amazon();}
console.log('al venir de FPS debemos mostrar en tps los avatares');}
console.log('el statdo tps  deberia ser 1 y es ');console.log(stat_view_TPS);view='TPS';stat_view=stat_view_TPS;getJSFunction('set_stat_view')(stat_view,view);hide_controls_touch1();}
function show_authors_list(){setHTMLElemStyle('visibility','visible','Authors_List',true);setHTMLElemStyle('opacity','1','Authors_List',true);setHTMLElemStyle('zIndex','4','Authors_List',true);}
function hide_authors_list(){setHTMLElemStyle('visibility','hidden','Authors_List',true);setHTMLElemStyle('opacity','1','Authors_List',true);setHTMLElemStyle('zIndex','0','Authors_List',true);}
function Go_FPS(){if(stat_view_orbit==1&&(stat_view_FPS==0||stat_view_TPS==0)){setActiveCamera("Cam_firstperson");snapToObject("Cam_firstperson","pos_char");snapToObject("Cam_firstperson2","Cam_firstperson");stat_view_FPS=1;console.log('Se ha camabiado camara a FPS! desde orbittps');stat_view_TPS=0;view='TPS';stat_view=stat_view_TPS;getJSFunction('set_stat_view')(stat_view,view);stat_view_orbit=0;view='orbit';stat_view=stat_view_orbit;getJSFunction('set_stat_view')(stat_view,view);}else if(stat_view_TPS==1&&(stat_view_orbit==0||stat_view_FPS==0)){console.log('Se ha camabiado camara a FPS! desde tps');setActiveCamera("Cam_firstperson");snapToObject("Cam_firstperson2","Cam_firstperson");console.log('debiamos ir a la x:');console.log(getObjTransform("hunter_physic","position","x"));setObjTransform("Cam_firstperson","position",getObjTransform("pos_char","position","x"),getObjTransform("pos_char","position","z"),getObjTransform("pos_char","position","y"),true);snapToObject("Cam_firstperson","pos_char");stat_view_TPS=0;view='TPS';stat_view=stat_view_TPS;getJSFunction('set_stat_view')(stat_view,view);stat_view_FPS=1;console.log('debiamos ir a la x anterior y vamos a:');console.log(getObjTransform("Cam_firstperson2","position","x"));console.log('veamos a que altura z');console.log(getObjTransform("Cam_firstperson","position","y"));}
if(is_selected_char_hunter){hide_body_hunter();}else if(is_selected_char_amazon){hide_body_amazon();}
show_body_hunter_fps();if(featureAvailable("MOBILE")){view='FPS';stat_view=stat_view_FPS;getJSFunction('set_stat_view')(stat_view,view);}
hide_controls_touch1();}
function show_nex_level_btn(){setHTMLElemStyle('visibility','visible','Next_Level_Dialeg_Sub',true);setHTMLElemStyle('opacity','1','Next_Level_Dialeg_Sub',true);setHTMLElemStyle('zIndex','4','Next_Level_Dialeg_Sub',true);}
function hide_nex_level_btn(){setHTMLElemStyle('visibility','hidden','Next_Level_Dialeg_Sub',true);setHTMLElemStyle('opacity','1','Next_Level_Dialeg_Sub',true);setHTMLElemStyle('zIndex','0','Next_Level_Dialeg_Sub',true);}
function controls_touch(){if(!stat_show_controls_touch){stat_show_controls_touch=1;hide_controls_touch();}else if(stat_show_controls_touch){stat_show_controls_touch=0;show_controls_touch();}}
function controls_touch2(){if(!stat_show_controls_touch2){hide_controls_touch2();stat_show_controls_touch2=1;}else if(stat_show_controls_touch2){show_controls_touch2();stat_show_controls_touch2=0;}}
function show_controls_touch(){setHTMLElemStyle('visibility','visible','Control_Jump',true);setHTMLElemStyle('visibility','visible','Control_Attack',true);setHTMLElemStyle('visibility','visible','Control_Out_Vehicle',true);}
function hide_controls_touch(){setHTMLElemStyle('visibility','hidden','Control_Jump',true);setHTMLElemStyle('visibility','hidden','Control_Attack',true);setHTMLElemStyle('visibility','hidden','Control_Out_Vehicle',true);}
function controls_touch1(){if(!stat_show_controls_touch1){hide_controls_touch1();stat_show_controls_touch1=1;}else if(stat_show_controls_touch1){show_controls_touch1();stat_show_controls_touch1=0;}}
function show_controls_touch2(){setHTMLElemStyle('visibility','visible','Control_View_Orbit',true);setHTMLElemStyle('visibility','visible','Control_View_FPS',true);setHTMLElemStyle('visibility','visible','Control_View_TPS',true);}
function show_controls_touch1(){setHTMLElemStyle('visibility','visible','Reset_Char',true);setHTMLElemStyle('visibility','visible','Restart_Pos_Char',true);if(stat_view_FPS&&!featureAvailable("MOBILE")){show_pointer_lock_btn_FPS();}else if(stat_view_TPS&&!featureAvailable("MOBILE")){show_pointer_lock_btn_TPS();}else if(stat_view_orbit){hide_pointer_lock_btn_TPS();hide_pointer_lock_btn_FPS();}}
function hide_controls_touch2(){setHTMLElemStyle('visibility','hidden','Control_View_Orbit',true);setHTMLElemStyle('visibility','hidden','Control_View_FPS',true);setHTMLElemStyle('visibility','hidden','Control_View_TPS',true);}
function hide_controls_touch1(){setHTMLElemStyle('visibility','hidden','Reset_Char',true);setHTMLElemStyle('visibility','hidden','Restart_Pos_Char',true);hide_pointer_lock_btn_TPS();hide_pointer_lock_btn_FPS();}
function show_controls_test(){setHTMLElemStyle('visibility','visible','Buttons',true);setHTMLElemStyle('visibility','visible','Buttons1',true);setHTMLElemStyle('visibility','visible','Buttons2',true);}
function hide_controls_test(){setHTMLElemStyle('visibility','hidden','Buttons',true);setHTMLElemStyle('visibility','hidden','Buttons1',true);setHTMLElemStyle('visibility','hidden','Buttons2',true);}
function Go_POINTERLK(){if(stat_view_orbit==1&&(stat_view_FPS==0||stat_view_TPS==0)){setActiveCamera("Cam_firstperson");stat_view_orbit=0;stat_pt_lock_js=1;stat_view_TPS=0;}else if(stat_view_TPS==1&&(stat_view_orbit==0||stat_view_FPS==0)){console.log('Se ha camabiado camara a pointer! desde orbit');setActiveCamera("Cam_firstperson");console.log('debiamos ir a la x:');console.log(getObjTransform("hunter_physic","position","x"));setObjTransform("Cam_FPS_plock","rotation",0,0,0,true);setObjTransform("Cam_FPS_plock","position",getObjTransform("pos_char","position","x"),getObjTransform("pos_char","position","z"),getObjTransform("pos_char","position","y"),true);stat_view_TPS=0;stat_pt_lock_js=1;console.log('Se ha camabiado camara a pointer desde tps');console.log('debiamos ir a la x anterior y vamos a:');console.log(getObjTransform("Cam_firstperson","position","x"));}
console.log('no deberiamos dudar que la camera es plock');console.log('y que salimos de ella cuando conmuntamos al resto');}
function setup_touch_controls(st_tch_rght,st_tch_up,st_tch_left,st_tch_down,st_tch_jump,st_tch_attack,st_tch_TPS,st_tch_FPS,st_tch_orbit,st_tch_fly,st_tch_r_giro,st_tch_l_giro){if(st_tch_TPS&&featureAvailable("MOBILE")){Go_TPS();}else if(st_tch_FPS&&featureAvailable("MOBILE")){Go_FPS();}else if(st_tch_orbit&&featureAvailable("MOBILE")){Go_ORBIT_TPS();}
if(st_tch_jump){move_jump2();}
stat_mobile_device=1;stat_mov_front=st_tch_up;stat_move_back=st_tch_down;stat_move_left=st_tch_left;stat_move_right=st_tch_rght;stat_giro_left=st_tch_l_giro;stat_giro_right=st_tch_r_giro;stat_fly=st_tch_fly;stat_attack=st_tch_attack;console.log('estamos en un dispositivo movil y TPS en puzzle');if(stat_mov_front){console.log('estamos andando hacia adelante en tps en puzzle');}
if(stat_giro_left){console.log('estamos girando hacia la izq en puzzle');}}
appInstance.ExternalInterface["setup_touch_controls"]=setup_touch_controls;function nivel_siguiente(){console.log('cuando hayamos superado el primero');console.log('ej Por conseguir objetivos o ptos ');console.log('evidentemente abrira y cerrara escenas');console.log('y el siguiente nivel es o no level_campo');console.log('al cargar char se carga level y actualiza ');console.log('current level index');current_level=levels[current_level_index+1];console.log('y el siguiente nivel es o no level_campo');console.log(current_level);}
function game_paused(){show_game_main();stat_game_paused=1;hide_game_menu_calling();operateAnimation("STOP","hunter_rig",null,null,'AUTO',1,function(){},undefined,false);}
function game_resume(){hide_game_main();stat_game_paused=0;show_game_menu_calling();}
function unloadScene(url){if(appInstance.scene){var scene=url===''?appInstance.scene:appInstance.scene.getObjectByName(url);if(scene)appInstance.unload(scene);if(!appInstance.scene)appInstance.renderer.clear();_pGlob.objCache={};}}
function game_restart(){unloadScene('atlantida.gltf');console.log('deberiamos poder abrir una pagina a continuacion');console.log('parece que no lo hace si los ptos son 0');getJSFunction('game_restart_sub_btn_cb')();}
function loadSound(url){var elems=_pGlob.mediaElements;if(!(url in elems)){elems[url]=document.createElement("audio");elems[url].src=url;}
return elems[url];}
function isSoundPlaying(audioElem){if(!audioElem)
return false;return((audioElem.duration>0)&&(!audioElem.paused));}
function pauseSound(audioElem){if(!audioElem)
return;audioElem.pause();}
function rewindSound(audioElem){if(!audioElem)
return;audioElem.currentTime=0;}
function descarga_current_level_y_character(){if(amazon_loaded){unloadScene('assets/characters/amazon/amazon.gltf.xz');amazon_loaded=0;console.log('amazon_loaded_es 0');console.log('se descargo scena amazon char');}else if(hunter_loaded){unloadScene('assets/characters/hunter/thehunter.gltf.xz');hunter_loaded=0;console.log('hunter_loaded_es 0');console.log('se descargo scena hunter char');}
if(isSoundPlaying(loadSound("assets/sound/playlist/Casbah_Towers.mp3"))){pauseSound(loadSound("assets/sound/playlist/Casbah_Towers.mp3"));rewindSound(loadSound("assets/sound/playlist/Casbah_Towers.mp3"));}else if(isSoundPlaying(loadSound("assets/sound/playlist/Ticker.mp3"))){pauseSound(loadSound("assets/sound/playlist/Ticker.mp3"));rewindSound(loadSound("assets/sound/playlist/Ticker.mp3"));}
if(current_level=='level_city'){current_level_index=0;unloadScene(level_path[0]);}else if(current_level=='level_campo'){current_level_index=1;unloadScene(level_path[1]);}
current_level_loaded=0;unloadScene('');}
function hide_repes_finalizat(){hide_game_main();if(!featureAvailable("MOBILE")){hide_pointer_lock_btn_FPS();}
hide_game_menu_calling();hide_pick_objs();hide_controls();hide_main_game_stats();stat_game_finised=1;hide_controls_touch();hide_controls_touch1();hide_controls_touch2();hide_controls_touch3();}
function hide_repes_no_finalizat(){hide_game_main();if(!featureAvailable("MOBILE")){hide_pointer_lock_btn_FPS();}
hide_pick_objs();hide_controls();hide_main_game_stats();hide_controls_touch();hide_controls_touch1();hide_controls_touch2();hide_controls_touch3();}
function next_help(){if(page_help==1){if(current_lang=='es'){setHTMLElemAttribute('src','interface/help_desk_es_p2.png','Img_Panel',true);}else if(current_lang=='en'){setHTMLElemAttribute('src','interface/help_desk_en_p2.png','Img_Panel',true);}
page_help=(typeof page_help=='number'?page_help:0)+1;show_help_exit();}else if(page_help==2){if(current_lang=='es'){setHTMLElemAttribute('src','interface/help_desk_es_p3.png','Img_Panel',true);}else if(current_lang=='en'){setHTMLElemAttribute('src','interface/help_desk_en_p3.png','Img_Panel',true);}
page_help=(typeof page_help=='number'?page_help:0)+1;}else if(page_help==3){if(current_lang=='es'){setHTMLElemAttribute('src','interface/help_desk_es_p4.png','Img_Panel',true);}else if(current_lang=='en'){setHTMLElemAttribute('src','interface/help_desk_en_p4.png','Img_Panel',true);}
page_help=(typeof page_help=='number'?page_help:0)+1;}else if(page_help==4){if(current_lang=='es'){setHTMLElemAttribute('src','interface/help_desk_es_p5.png','Img_Panel',true);}else if(current_lang=='en'){setHTMLElemAttribute('src','interface/help_desk_en_p5.png','Img_Panel',true);}
page_help=(typeof page_help=='number'?page_help:0)+1;show_help_descr();hide_help_next();}}
function getHTMLElemAttribute(attr,id,isParent){var elem=getElement(id,isParent);return elem?elem[attr]:'';}
function cheats_menu(){if(getHTMLElemAttribute('checked','F02_Sound',false)){f01_play_sound();}else if(!getHTMLElemAttribute('checked','F02_Sound',false)){f01_pause_sound();}
if(getHTMLElemAttribute('checked','F02_Anims',false)){stat_previ_storage_clear=1;stat_clear_storage=stat_previ_storage_clear;getJSFunction('storage_clear')(stat_clear_storage);console.log('provisionalmente borramos aqui storage al animar');}else if(!getHTMLElemAttribute('checked','F02_Anims',false)){stat_previ_storage_clear=0;stat_clear_storage=stat_previ_storage_clear;console.log('deberia actualizarse a 0 clear storage ');console.log('y dejar guardar estados previos');getJSFunction('storage_clear')(stat_clear_storage);}
if(getHTMLElemAttribute('checked','F02_Idiome_ES/EN',false)){lang='es';getJSFunction('switch_lang')(lang);current_lang=lang;}else if(!getHTMLElemAttribute('checked','F02_Idiome_ES/EN',false)){lang='en';getJSFunction('switch_lang')(lang);current_lang=lang;}
console.log('el idioma seleccinado es');console.log(current_lang);if(getHTMLElemAttribute('checked','F02-Text_Off-On',false)){hide_help_f2();console.log('texto on-off ahora lo testamos');}else if(!getHTMLElemAttribute('checked','F02-Text_Off-On',false)){show_help_f2();}}
function objectTreeFilterUnload(rootObj,filterFun){var objsToUnload=[];(function traverse(obj){if(filterFun(obj)){objsToUnload.push(obj);return;}
obj.children.forEach(function(child){traverse(child);});})(rootObj);objsToUnload.forEach(function(obj){appInstance.unload(obj);});}
function appendScene(url,loadCameras,loadLights,loadCb,progCb){_pGlob.percentage=0;appInstance.appendScene(url,function(loadedScene){if(!loadCameras||!loadLights){objectTreeFilterUnload(loadedScene,function(obj){return obj.isCamera&&!loadCameras||obj.isLight&&!loadLights;});}
loadedScene.name=url;_pGlob.percentage=100;loadCb();},function(percentage){_pGlob.percentage=percentage;progCb();},null);}
function load_casset(){appendScene('assets/sound/ej_model_casset/BoomBox.gltf',false,false,function(){setObjTransform("BoomBox","scale",20,20,20,true);casset_loaded=1;},function(){});}
function load_pick_object(hunter_loaded,amazon_loaded){appendScene('assets/pick_objects/pick_objects.gltf.xz',true,true,function(){console.log('se cargaron pick objects base');setHTMLElemStyle('display','none','Progress_Bar',true);pick_loaded=1;console.log('solo si load pick se hizo tras cargar city');console.log('porque carga sus spawn');init_pos_pick_objects2();},function(){show_progress_bar();});}
function loadScene(url,loadCb,progCb){appInstance.unload();_pGlob.objCache={};_pGlob.percentage=0;appInstance.loadScene(url,function(loadedScene){appInstance.enableControls();loadedScene.name=url;_pGlob.percentage=100;loadCb();},function(percentage){_pGlob.percentage=percentage;progCb();},null);}
function load_scene_change_char(){if(!(scene_main_loaded==1)){loadScene('atlantida.gltf.xz',function(){scene_main_loaded=1;},function(){});console.log('scene main cargada');console.log('solo habia sido descargada en change character menu');}
if(!(scene_change_char_loaded==1)){appendScene('assets/char_select/char_select.gltf.xz',true,true,function(){console.log('se cargo char select');setHTMLElemStyle('display','none','Progress_Bar',true);scene_change_char_loaded=1;selectable_list_chars=["select_a","select_h"];console.log('estado change char es 1');hide_form_f01_change_char_menu();setActiveCamera("camera_low_scene");tweenCamera("pos_cam_low_scene","pivot_change_char",3,function(){});},function(){show_progress_bar();});}}
function show_progress_bar(){setHTMLElemStyle('display','block','Progress_Bar',true);setHTMLElemAttribute('innerHTML',String(Math.round(_pGlob.percentage))+String('%'),'Loading_Percentage',true);setHTMLElemStyle('width',String(Math.round(_pGlob.percentage))+String('%'),'Red_Apple',true);}
function load_amazon_char(){if(!amazon_loaded){appendScene('assets/characters/amazon/amazon.gltf.xz',true,true,function(){console.log('se cargo amazon scena');setHTMLElemStyle('display','none','Progress_Bar',true);amazon_loaded=1;console.log('amazon_loaded_es 1');},function(){show_progress_bar();});}else if(hunter_loaded){unloadScene('assets/characters/hunter/thehunter.gltf.xz');hunter_loaded=0;console.log('hunter_loaded_es 0');console.log('se descargo scena hunter char');}
console.log('antes de aplicar la fisica personaje esta en');console.log(getObjTransform("hunter_physic","position","y"));if(!current_level_loaded){if(current_level=='level_city'){current_level_index=0;}else if(current_level=='level_campo'){current_level_index=1;}
appendScene(level_path[current_level_index],true,true,function(){level_parameters();play_music_level();current_level_loaded=1;stat_view_TPS=1;stat_game_paused=1;setActiveCamera("Cam_down_ctrl");tweenCamera('',"camera_target",1,function(){});show_run_tool();},function(){show_progress_bar();});}}
function registerSetTimeout(timeout,callback){window.setTimeout(callback,1000*timeout);}
function load_hunter_char(){if(!hunter_loaded){appendScene('assets/characters/hunter/thehunter.gltf.xz',true,true,function(){console.log('se cargo thehunter scena');hunter_loaded=1;console.log('hunter_loaded_es 1');registerSetTimeout(3,function(){setHTMLElemStyle('display','none','Progress_Bar',true);});},function(){show_progress_bar();});}else if(amazon_loaded){unloadScene('assets/characters/amazon/amazon.gltf.xz');amazon_loaded=0;console.log('amazon_loaded_es 0');console.log('se descargo scena amazon char');}
console.log('antes de aplicar la fisica personaje esta en');console.log(getObjTransform("hunter_physic","position","y"));if(!current_level_loaded){if(current_level=='level_city'){current_level_index=0;}else if(current_level=='level_campo'){current_level_index=1;}
appendScene(level_path[current_level_index],true,true,function(){current_level_loaded=1;stat_view_TPS=1;level_parameters();play_music_level();stat_game_paused=1;setActiveCamera("Cam_down_ctrl");tweenCamera('',"camera_target",1,function(){});show_run_tool();},function(){show_progress_bar();});}}
function play_music_level(){console.log('aqui deberiamos poner un random');music_level_ticker();}
function volume(audioElem,volume){if(!audioElem)
return;if(typeof volume!="number")
return;audioElem.volume=v3d.Math.clamp(volume,0.0,1.0);}
function playSound(audioElem,loop){if(!audioElem)
return;audioElem.loop=loop;audioElem.play();}
function music_level_towers(){volume(loadSound("assets/sound/playlist/Casbah_Towers.mp3"),0.3);volume(loadSound("assets/sound/playlist/Ticker.mp3"),0.3);if(!isSoundPlaying(loadSound("assets/sound/playlist/Casbah_Towers.mp3"))){playSound(loadSound("assets/sound/playlist/Casbah_Towers.mp3"),true);}else if(isSoundPlaying(loadSound("assets/sound/playlist/Ticker.mp3"))){pauseSound(loadSound("assets/sound/playlist/Ticker.mp3"));rewindSound(loadSound("assets/sound/playlist/Ticker.mp3"));}}
function level_parameters(){console.log('se cargo scena city base');setHTMLElemStyle('display','none','Progress_Bar',true);console.log('la posicion del empty person_pos_0 es');console.log(getObjTransform("person_pos_0","position","y"));snapToObject("hunter_physic","person_pos_0");console.log('la pos el char tras ajuste a tal pos del empty');console.log(getObjTransform("hunter_physic","position","y"));init_physics();current_level_loaded=1;load_pick_object(hunter_loaded,amazon_loaded);}
function music_level_ticker(){volume(loadSound("assets/sound/playlist/Ticker.mp3"),0.3);volume(loadSound("assets/sound/playlist/Casbah_Towers.mp3"),0.3);if(!isSoundPlaying(loadSound("assets/sound/playlist/Ticker.mp3"))){playSound(loadSound("assets/sound/playlist/Ticker.mp3"),true);}else if(isSoundPlaying(loadSound("assets/sound/playlist/Casbah_Towers.mp3"))){pauseSound(loadSound("assets/sound/playlist/Casbah_Towers.mp3"));rewindSound(loadSound("assets/sound/playlist/Casbah_Towers.mp3"));}}
function mathRandomInt(a,b){if(a>b){var c=a;a=b;b=c;}
return Math.floor(Math.random()*(b-a+1)+a);}
function findUniqueObjectName(name){function objNameUsed(name){return Boolean(getObjectByName(name));}
while(objNameUsed(name)){var r=name.match(/^(.*?)(\d+)$/);if(!r){name+="2";}else{name=r[1]+(parseInt(r[2],10)+1);}}
return name;}
function cloneObject(objName){if(!objName)
return;var obj=getObjectByName(objName);if(!obj)
return;var newObj=obj.clone();newObj.name=findUniqueObjectName(obj.name);appInstance.scene.add(newObj);return newObj.name;}
function clone_fruit_random2(){random_number=mathRandomInt(1,4);if(random_number==1){fruit_clone=cloneObject("a_plastic_barrel");}else if(random_number==2){fruit_clone=cloneObject("c_moneda_100");}else if(random_number==3){fruit_clone=cloneObject("plastic_barrel.001");}else if(random_number==4){fruit_clone=cloneObject("s_maletin_life_100");}}
function score_time_counting(add_time,add_score){score=score+add_score;time=time+add_time;setHTMLElemAttribute('innerHTML',time,'Time',true);setHTMLElemAttribute('innerHTML',score,'Score',true);}
function makeParent(objName,targetObjName){if(!objName)
return;var obj=getObjectByName(objName);if(!obj)
return;if(targetObjName){var targetObj=getObjectByName(targetObjName);if(!targetObj)
return;}else{obj.traverseAncestors(function(ancObj){if(ancObj.type=="Scene")
targetObj=ancObj;});}
var matOffset=new v3d.Matrix4();matOffset.getInverse(targetObj.matrixWorld);matOffset.multiply(obj.matrixWorld);matOffset.decompose(obj.position,obj.quaternion,obj.scale);targetObj.add(obj);obj.updateMatrixWorld(true);}
function init_pos_pick_objects2(){fruits_max=11;fruits_count[0]=0;fruits_count[1]=0;fruits_count[2]=0;fruits_count[3]=0;setHTMLElemAttribute('innerHTML',fruits_count[0],'apple_count',true);setHTMLElemAttribute('innerHTML',fruits_count[1],'cherry_count',true);setHTMLElemAttribute('innerHTML',fruits_count[2],'pear_count',true);setHTMLElemAttribute('innerHTML',fruits_count[3],'strawberry_count',true);for(i=1;i<=11;i++){if(emptys_witch_fruits[i]!='Empty'){changeVis(emptys_witch_fruits[i],false);emptys_witch_fruits[i]='Empty';}}
for(i=1;i<=9;i++){emptys_reorientats=String('Empty.00')+String(i);clone_fruit_random2();emptys_witch_fruits[i]=fruit_clone;makeParent(fruit_clone,emptys_reorientats);snapToObject(fruit_clone,emptys_reorientats);}
for(i=10;i<=11;i++){emptys_reorientats=String('Empty.0')+String(i);clone_fruit_random2();emptys_witch_fruits[i]=fruit_clone;makeParent(fruit_clone,emptys_reorientats);snapToObject(fruit_clone,emptys_reorientats);}}
function fruit_count(index){if(emptys_witch_fruits[index].charAt(0)=='a'){fruits_count[0]=fruits_count[0]+1;setHTMLElemAttribute('innerHTML',fruits_count[0],'Apple_Count',true);changeVis(emptys_witch_fruits[index],false);score_time_counting(-10,2);emptys_witch_fruits[index]='Empty';}else if(emptys_witch_fruits[index].charAt(0)=='c'){fruits_count[1]=fruits_count[1]+1;setHTMLElemAttribute('innerHTML',fruits_count[1],'Cherry_Count',true);changeVis(emptys_witch_fruits[index],false);score_time_counting(0,5);emptys_witch_fruits[index]='Empty';}else if(emptys_witch_fruits[index].charAt(0)=='p'){fruits_count[2]=fruits_count[2]+1;setHTMLElemAttribute('innerHTML',fruits_count[2],'Pear_Count',true);changeVis(emptys_witch_fruits[index],false);score_time_counting(0,4);emptys_witch_fruits[index]='Empty';}else if(emptys_witch_fruits[index].charAt(0)=='s'){fruits_count[3]=fruits_count[3]+1;setHTMLElemAttribute('innerHTML',fruits_count[3],'Strawberry_Count',true);changeVis(emptys_witch_fruits[index],false);score_time_counting(10,3);emptys_witch_fruits[index]='Empty';}}
function sound_listener_cb(sound_positional,sound_listener){if(casset_loaded){console.log('sound que traemos a puzzle o solo llevamos app');console.log('finalmente no hacen falta los parent siguientes');console.log(' los haremos ej js');}}
appInstance.ExternalInterface["sound_listener_cb"]=sound_listener_cb;initObjectPicking(function(obj){_pGlob.pickedObject=obj?getPickedObjectName(obj):'';_pGlob.objClickCallbacks.forEach(function(el){var isPicked=obj&&objectsIncludeObj(el.objNames,getPickedObjectName(obj));el.callbacks[isPicked?0:1]();});},'mousedown');function registerOnClick(objNames,cbDo,cbIfMissedDo){objNames=retrieveObjectNames(objNames)||[];var objNamesFiltered=objNames.filter(function(name){return name;});_pGlob.objClickCallbacks.push({objNames:objNamesFiltered,callbacks:[cbDo,cbIfMissedDo]});}
function f01_play_sound(){if(!sound_casset){sound_casset=1;console.log('picamos casset con puzzle codec');getJSFunction('casset_music_cb')(sound_casset);}}
function clicked_a(){if((_pGlob.pickedObject=="select_a"||is_selected_char_amazon)&&stat_change_char){console.log('as selected amazon char');is_selected_char_amazon=1;is_selected_char_hunter=0;console.log('as selected amazon char');console.log('estado change char es 0');getJSFunction('store_init_cb')(current_level,current_score,time_full,current_lang,stat_game_finised,'amazon',stat_change_char);stat_change_char=0;scene_change_char_loaded=0;view='change_char';stat_view=stat_change_char;getJSFunction('set_stat_view')(stat_view,view);show_button_startout_game();console.log('si hemosseleccionado char ahora cargamos juego');console.log('para lograrlo provocamos un click btn load game');unloadScene('assets/char_select/char_select.gltf.xz');f01_anims_off();casset_loaded=0;hide_icon_change_char();f01_pause_sound();hide_help_f01();hide_form_f01_change_char_menu();hide_button_select_avatars();}}
function clicked_h(){if((_pGlob.pickedObject=="select_h"||is_selected_char_hunter)&&stat_change_char){is_selected_char_amazon=0;console.log('as select  hunter char');console.log('estado change char es 0');getJSFunction('store_init_cb')(current_level,current_score,time_full,current_lang,stat_game_finised,'hunter',stat_change_char);stat_change_char=0;scene_change_char_loaded=0;view='change_char';stat_view=stat_change_char;getJSFunction('set_stat_view')(stat_view,view);show_button_startout_game();console.log('si hemosseleccionado char ahora cargamos juego');console.log('para lograrlo provocamos un click btn load game');unloadScene('assets/char_select/char_select.gltf.xz');f01_anims_off();casset_loaded=0;hide_icon_change_char();f01_pause_sound();hide_help_f01();hide_form_f01_change_char_menu();hide_button_select_avatars();}}
function f01_pause_sound(){if(sound_casset){sound_casset=0;console.log('la siguiente fon solo silencia');getJSFunction('casset_music_cb')(sound_casset);}}
function change_char_menu(){if(stat_change_char&&stat_show_f01){if(getHTMLElemAttribute('checked','F01_Sound',false)){f01_play_sound();}else if(!getHTMLElemAttribute('checked','F01_Sound',false)){f01_pause_sound();}
if(getHTMLElemAttribute('checked','F01_Anims',false)){f01_anims_on();}else if(!getHTMLElemAttribute('checked','F01_Anims',false)){f01_anims_off();}
if(getHTMLElemAttribute('checked','F01_Idiome_ES/EN',false)){lang='es';getJSFunction('switch_lang')(lang);current_lang=lang;}else if(!getHTMLElemAttribute('checked','F01_Idiome_ES/EN',false)){lang='en';getJSFunction('switch_lang')(lang);current_lang=lang;}
console.log('el idioma seleccinado es');console.log(current_lang);if(getHTMLElemAttribute('checked','F01-Text_Off-On',false)){hide_help_f01();}else if(!getHTMLElemAttribute('checked','F01-Text_Off-On',false)){show_help_f01();}}}
function f01_anims_on(){if(!(isAnimationPlaying("hunter_rig_h")&&isAnimationPlaying("hunter_rig_a"))){operateAnimation("PLAY","hunter_rig_a",null,null,'LoopRepeat',1,function(){},undefined,false);operateAnimation("PLAY","hunter_rig_h",null,null,'LoopRepeat',1,function(){},undefined,false);}}
function f01_anims_off(){if(isAnimationPlaying("hunter_rig_h")&&isAnimationPlaying("hunter_rig_a")){operateAnimation("STOP","hunter_rig_a",null,null,'AUTO',1,function(){},undefined,false);operateAnimation("STOP","hunter_rig_h",null,null,'AUTO',1,function(){},undefined,false);}}
function storage_get_game_parameters_cb(level_local,score_local,time_local,lang_local){}
appInstance.ExternalInterface["storage_get_game_parameters_cb"]=storage_get_game_parameters_cb;function storage_get_state_game_cb(current_position_X,current_position_Y,current_position_Z,current_char_local,current_level_local,current_lang_local,current_time_local,current_score_local){if(current_level==current_level_local){current_char=current_char_local;current_level=current_level_local;current_lang=current_lang_local;current_time=current_time_local;current_score=current_score_local;restore_pos_char(current_position_X,current_position_Y,current_position_Z);Go_TPS();show_run_tool();}else{console.log('deberiamos avisar al usuario que no esta en');console.log('mismo nivel que la ultima vez que guardo');}}
appInstance.ExternalInterface["storage_get_state_game_cb"]=storage_get_state_game_cb;function mensajes_game_store(){console.log('el actual nivel es');console.log(current_level);console.log('y el nivel  almacenado es');console.log(level_local);console.log('el actual score alcanzado es');console.log(score);console.log('y el score  almacenado es');console.log(score_local);console.log('el tiempo  total de partida es');console.log(time);console.log('el tiempo  almacenado es');console.log(time_local);console.log('el idioma  almacenado es');console.log(lang_local);console.log('el idioma  seleccionado  es');console.log(lang);}
function save_stat(){if(is_selected_char_amazon){current_char='amazon';}else if(is_selected_char_hunter){current_char='hunter';}
person_position_X=getObjTransform("hunter_physic","position","x");person_position_Y=getObjTransform("hunter_physic","position","z");person_position_Z=getObjTransform("hunter_physic","position","y");getJSFunction('storage_set_state_game_cb')(person_position_X,person_position_Y,person_position_Z,current_char,current_level,current_lang,current_time,current_score);}
function initGetCameraDirection(){var coordsCallback=function(event){event.preventDefault();var xNorm=0,yNorm=0;if(event instanceof MouseEvent){xNorm=event.offsetX/elem.clientWidth;yNorm=event.offsetY/elem.clientHeight;}else if(event instanceof TouchEvent){var rect=elem.getBoundingClientRect();xNorm=(event.changedTouches[0].clientX-rect.left)/rect.width;yNorm=(event.changedTouches[0].clientY-rect.top)/rect.height;}
_pGlob.screenCoords.x=xNorm*2-1;_pGlob.screenCoords.y=-yNorm*2+1;}
var elem=appInstance.container;elem.addEventListener('mousemove',coordsCallback);elem.addEventListener('mousedown',coordsCallback);elem.addEventListener('mouseup',coordsCallback);elem.addEventListener('touchstart',coordsCallback);elem.addEventListener('touchend',coordsCallback);};initGetCameraDirection();var getCameraDirection=function(){var coords=new v3d.Vector2();var raycaster=new v3d.Raycaster();return function getCameraDirection(useMouseTouch,inverted){var camera=appInstance.camera;if(useMouseTouch){if(inverted){coords.x=-_pGlob.screenCoords.x;coords.y=-_pGlob.screenCoords.y;}else{coords.x=_pGlob.screenCoords.x;coords.y=_pGlob.screenCoords.y;}
raycaster.setFromCamera(coords,camera);var dir=raycaster.ray.direction;}else{var dir=camera.getWorldDirection(new v3d.Vector3());}
return[dir.x,-dir.z,dir.y];}}();function getObjDirection(objName,coord){if(!objName)
return;var obj=getObjectByName(objName);if(!obj)
return;var dir=obj.getWorldDirection(new v3d.Vector3());switch(coord){case'X':return dir.x;case'Y':return-dir.z;case'Z':return dir.y;case'XYZ':return[dir.x,-dir.z,dir.y];default:console.error("get object direction: Wrong coords");return;}};function idle2(){camDir=getCameraDirection(true,false);charDir=getObjDirection("hunter_physic","XYZ");if(stat_view_TPS==1){}else if(stat_view_FPS==1){setObjTransform("Cam_firstperson","position",camDir[0]*0,camDir[1]*0,camDir[2]*0,true);}}
function restore_pos_char2(person_position_X,person_position_Y,person_position_Z){stat_view_TPS=1;console.log('Se ha restablecido poscion character!');console.log('si los datos son correctos tenemos de posicion X');console.log(person_position_X);console.log('e Y position restablecida ');console.log(person_position_Y);console.log('y Z position restablecida ');console.log(person_position_Z);physicsApplyVector("POSITION","hunter_physic",person_position_X,person_position_Y,person_position_Z);setObjTransform("hunter_physic","rotation",0,0,0,true);}
function move_back(){camDir=getCameraDirection(true,false);charDir=getObjDirection("hunter_physic","XYZ");if(stat_view_TPS==1){physicsApplyVector("LINEAR_VELOCITY","hunter_physic",charDir[0]* -2,charDir[1]* -2,charDir[2]* -2);console.log('estamos corriendo back con personaje');}else if(stat_view_FPS==1){setObjTransform("Cam_firstperson","position",camDir[0]* -0.2,camDir[1]* -0.2,camDir[2]*0,true);console.log('estamos corriendo back con camara');}}
function move_jump2(){camDir=getCameraDirection(true,false);person_position_Z=getObjTransform("hunter_physic","position","y");if(stat_view_TPS==1){if(person_position_Z<5){physicsApplyVector("IMPULSE","hunter_physic",0,0,0.5);console.log('posiscion Z del tps char');console.log(person_position_Z);}}else if(stat_view_FPS==1){camDir=getCameraDirection(true,false);if(!stat_cam_go_down&&getObjTransform("Cam_firstperson2","position","y")<cam_pos_z_max){snapToObject("Cam_firstperson2","Cam_firstperson");snapToObject("hunter_physic","Cam_firstperson");console.log('posiscion Z del tps char tps');console.log(person_position_Z);console.log('posiscion X de la camara en FPS antes de saltar');console.log(getObjTransform("Cam_firstperson2","position","x"));console.log('posiscion Y de la camara en FPS antes de saltar');console.log(getObjTransform("Cam_firstperson2","position","z"));console.log('posiscion Z de la camara en FPS antes de saltar');console.log(getObjTransform("Cam_firstperson2","position","y"));setObjTransform("Cam_firstperson2","position",camDir[0]*0.02,camDir[1]*0.02,0.1,true);current_pos_Z_fps=getObjTransform("Cam_firstperson2","position","y");cam_pos_z=current_pos_Z_fps;snapToObject("Cam_firstperson","Cam_firstperson2");}
if(getObjTransform("Cam_firstperson2","position","y")>=cam_pos_z_max){stat_cam_go_down=1;}
if(stat_cam_go_down&&!(cam_pos_z<=cam_pos_z_min)){setObjTransform("Cam_firstperson2","position",camDir[0]*0.02,camDir[1]*0.02,-0.1,true);snapToObject("Cam_firstperson","Cam_firstperson2");current_pos_Z_fps=getObjTransform("Cam_firstperson2","position","y");cam_pos_z=current_pos_Z_fps;}else if(stat_cam_go_down&&!(cam_pos_z==cam_pos_z_min)){stat_cam_go_down=0;}}}
function move_left2(){if(stat_view_TPS==1){physicsApplyVector("LINEAR_VELOCITY","hunter_physic",1,0,0);}else if(stat_view_FPS==1){console.log('go left fps');setObjTransform("Cam_firstperson","position",0.1,'','',true);}}
function move_front(){camDir=getCameraDirection(true,false);charDir=getObjDirection("hunter_physic","XYZ");if(stat_view_TPS==1){physicsApplyVector("LINEAR_VELOCITY","hunter_physic",charDir[0]*2,charDir[1]*2,charDir[2]*2);console.log('estamos corriendo adelante con char');}else if(stat_view_FPS==1){setObjTransform("Cam_firstperson","position",camDir[0]*0.2,camDir[1]*0.2,camDir[2]*0,true);console.log('estamos corriendo adelante con la camera');}}
function move_right2(){if(stat_view_TPS==1){physicsApplyVector("LINEAR_VELOCITY","hunter_physic",-1,0,0);}else if(stat_view_FPS==1){console.log('go right FPS');setObjTransform("Cam_firstperson","position",-0.1,'','',true);}}
function giro_left2(){if(stat_view_TPS==1){physicsApplyVector("ANGULAR_VELOCITY","hunter_physic",0,0,1);}else if(stat_view_FPS==1){applyObjLocalTransform("Cam_firstperson","rotation",0,cam_rotation_z*1,0);}}
function giro_right2(){if(stat_view_TPS==1){physicsApplyVector("ANGULAR_VELOCITY","hunter_physic",0,0,-1);}else if(stat_view_FPS==1){applyObjLocalTransform("Cam_firstperson","rotation",0,cam_rotation_z* -1,0);}}
function girando_lef_right(giro_left_o_right){if(stat_view_FPS){applyObjLocalTransform("Cam_firstperson","rotation",0,giro_left_o_right,0);}else if(stat_view_TPS){removePhysicsBody("hunter_physic");applyObjLocalTransform("hunter_physic","rotation",0,0,giro_left_o_right);createPhysicsBody("DYNAMIC","hunter_physic","BOX",1);physicsBodyParams("hunter_physic",0.7,0.5,0.2,0);}}
stat_view_TPS=0;stat_view_FPS=0;stat_view_orbit=0;pos_cam_x=0;pos_cam_y=0;orbit_prepos_x=0;orbit_prepos_y=0;stat_mobile_device=0;score=0;time=0;emptys_witch_fruits=[];emptys_distance=[];fruits_count=[0,0,0,0];fruits_amount=0;fruits_max=0;is_selected_char_amazon=0;is_selected_char_hunter=0;for(i=1;i<=11;i++){emptys_witch_fruits[i]='Empty';}
selectable_list_chars=[];amazon_loaded=0;hunter_loaded=0;pick_loaded=0;current_level_loaded=0;levels=['level_city','level_campo'];level_path=['assets/building/city/city_base.gltf.xz','assets/building/city2/city2_base.gltf.xz'];current_level_index=0;current_level=levels[current_level_index];final_level=0;final_level=levels.length-1;console.log('indice del ultimo nivel sera ');console.log(final_level);score_min_for_nex_level=24;time_full=160;current_score=0;current_lang='en';person_position_reset=0;cam_rot_reset=0;current_char='hunter';stat_storage_previ=0;stat_change_char=0;casset_loaded=0;scene_change_char_loaded=1;stat_game_paused=0;stat_game_finised=0;start_game=0;update_app_vars();camDir=0;charDir=0;person_position=0;move_steps=0;person_position_next=0;person_position_prev=0;start_game=0;stat_jump=0;stat_move_right=0;stat_move_left=0;stat_mov_front=0;stat_move_back=0;stat_giro_left=0;stat_giro_right=0;stat_attack=0;char_velocity_speed=0;stat_idle=0;cam_rotation_x=0;cam_rotation_y=0;cam_rotation_z=3;stat_bajando_fps_jump=0;stat_restablecido_fps_jump=1;person_position_Z=0;pos_cam_z=0;stat_previ_storage_clear=0;if(typeof window.Ammo=='function'){window.Ammo().then(function(Ammo){window.Ammo=Ammo;});}
_pPhysics.collisionConfiguration=new Ammo.btDefaultCollisionConfiguration();_pPhysics.dispatcher=new Ammo.btCollisionDispatcher(_pPhysics.collisionConfiguration);_pPhysics.broadphase=new Ammo.btDbvtBroadphase();_pPhysics.solver=new Ammo.btSequentialImpulseConstraintSolver();_pPhysics.world=new Ammo.btDiscreteDynamicsWorld(_pPhysics.dispatcher,_pPhysics.broadphase,_pPhysics.solver,_pPhysics.collisionConfiguration);_pPhysics.world.setGravity(new Ammo.btVector3(0,-9.8,0));_pPhysics.fps=128;_pPhysics.transTmp=new Ammo.btTransform();function tick(dt){var DISABLE_DEACTIVATION=4;var DISTANCE_EPSILON=0.000001;if(_pPhysics.collisionData.length){var numManifolds=_pPhysics.world.getDispatcher().getNumManifolds();for(var i=0;i<numManifolds;i++){var contactManifold=_pPhysics.world.getDispatcher().getManifoldByIndexInternal(i);var bodyA=Ammo.castObject(contactManifold.getBody0(),Ammo.btRigidBody);var bodyB=Ammo.castObject(contactManifold.getBody1(),Ammo.btRigidBody);var collDataMatch=null;var objsSwapped=false;for(var j=0;j<_pPhysics.collisionData.length;j++){var cd=_pPhysics.collisionData[j];if(cd.bodyA==bodyA&&cd.bodyB==bodyB){collDataMatch=cd;break;}
if(cd.bodyA==bodyB&&cd.bodyB==bodyA){collDataMatch=cd;objsSwapped=true;break;}}
if(!collDataMatch)
continue;var numContacts=contactManifold.getNumContacts();for(var j=0;j<numContacts;j++){var pt=contactManifold.getContactPoint(j);if(pt.getDistance()<DISTANCE_EPSILON){var ptA=pt.getPositionWorldOnA();var ptB=pt.getPositionWorldOnB();var noB=pt.get_m_normalWorldOnB();_pPhysics.collisionInfo.objectA=collDataMatch.objA?getPickedObjectName(collDataMatch.objA):'';_pPhysics.collisionInfo.objectB=collDataMatch.objB?getPickedObjectName(collDataMatch.objB):'';_pPhysics.collisionInfo.distance=pt.getDistance();if(!objsSwapped){_pPhysics.collisionInfo.positionOnA[0]=ptA.x();_pPhysics.collisionInfo.positionOnA[1]=ptA.y();_pPhysics.collisionInfo.positionOnA[2]=ptA.z();_pPhysics.collisionInfo.positionOnB[0]=ptB.x();_pPhysics.collisionInfo.positionOnB[1]=ptB.y();_pPhysics.collisionInfo.positionOnB[2]=ptB.z();_pPhysics.collisionInfo.normalOnB[0]=noB.x();_pPhysics.collisionInfo.normalOnB[1]=noB.y();_pPhysics.collisionInfo.normalOnB[2]=noB.z();}else{_pPhysics.collisionInfo.positionOnA[0]=ptB.x();_pPhysics.collisionInfo.positionOnA[1]=ptB.y();_pPhysics.collisionInfo.positionOnA[2]=ptB.z();_pPhysics.collisionInfo.positionOnB[0]=ptA.x();_pPhysics.collisionInfo.positionOnB[1]=ptA.y();_pPhysics.collisionInfo.positionOnB[2]=ptA.z();_pPhysics.collisionInfo.normalOnB[0]=-noB.x();_pPhysics.collisionInfo.normalOnB[1]=-noB.y();_pPhysics.collisionInfo.normalOnB[2]=-noB.z();}
collDataMatch.collideCb();collDataMatch.collideFlag=true;}}}
for(var i=0;i<_pPhysics.collisionData.length;i++){var cd=_pPhysics.collisionData[i];if(!cd.collideFlag){_pPhysics.collisionInfo.objectA='';_pPhysics.collisionInfo.objectB='';_pPhysics.collisionInfo.distance=0;_pPhysics.collisionInfo.positionOnA[0]=0;_pPhysics.collisionInfo.positionOnA[1]=0;_pPhysics.collisionInfo.positionOnA[2]=0;_pPhysics.collisionInfo.positionOnB[0]=0;_pPhysics.collisionInfo.positionOnB[1]=0;_pPhysics.collisionInfo.positionOnB[2]=0;_pPhysics.collisionInfo.normalOnB[0]=0;_pPhysics.collisionInfo.normalOnB[1]=0;_pPhysics.collisionInfo.normalOnB[2]=0;cd.noCollideCb();}
cd.collideFlag=false;}}
_pPhysics.world.stepSimulation(dt,10,1/128);for(var i=0;i<_pPhysics.syncList.length;i++){var syncData=_pPhysics.syncList[i];if(syncData.type=='DYNAMIC'){syncData.body.setActivationState(DISABLE_DEACTIVATION);var ms=syncData.body.getMotionState();if(ms){ms.getWorldTransform(_pPhysics.transTmp);var p=_pPhysics.transTmp.getOrigin();var q=_pPhysics.transTmp.getRotation();syncData.obj.position.set(p.x(),p.y(),p.z());syncData.obj.quaternion.set(q.x(),q.y(),q.z(),q.w());}}else if(syncData.type=='KINEMATIC'){var pos=syncData.obj.getWorldPosition(_pGlob.vec3Tmp);var quat=syncData.obj.getWorldQuaternion(_pGlob.quatTmp);_pPhysics.transTmp.setIdentity();_pPhysics.transTmp.setOrigin(new Ammo.btVector3(pos.x,pos.y,pos.z));_pPhysics.transTmp.setRotation(new Ammo.btQuaternion(quat.x,quat.y,quat.z,quat.w));syncData.body.setWorldTransform(_pPhysics.transTmp);}}}
appInstance.renderCallbacks.push(tick);current_pos_Z_fps=0;cam_pos_z=0.47;stat_cam_go_down=0;cam_pos_z_min=0.47;cam_pos_z_max=5;stat_girando_lef_right=0;eventHTMLElem('click','Container',false,function(event){if(stat_girando_lef_right&&stat_view_FPS){stat_girando_lef_right=0;}else if(stat_girando_lef_right&&stat_view_TPS){stat_girando_lef_right=0;}});eventHTMLElem('click','Pointerlock_Elem_TPS',false,function(event){if(stat_view_TPS){stat_girando_lef_right=1;console.log('activamos mousemove TPS');}});eventHTMLElem('click','Pointerlock_Elem_FPS',false,function(event){if(stat_view_FPS){stat_girando_lef_right=1;console.log('activamos mousemove FPS');}});eventHTMLElem('keyup',["BODY"],true,function(event){if(!stat_game_paused&&!stat_game_finised&&start_game){if((getEventProperty('key',event)=='ArrowLeft'||getEventProperty('key',event)=='a')&&(stat_view_FPS==1||stat_view_TPS==1)){console.log('go left up!');stat_move_left=0;}else if((getEventProperty('key',event)=='ArrowRight'||getEventProperty('key',event)=='d')&&(stat_view_FPS==1||stat_view_TPS==1)){console.log('go right up!');stat_move_right=0;}else if(getEventProperty('key',event)=='Enter'&&(stat_view_FPS==1||stat_view_TPS==1)){stat_jump=0;}else if((getEventProperty('key',event)=='ArrowUp'||getEventProperty('key',event)=='w')&&(stat_view_FPS==1||stat_view_TPS==1)){console.log('front up!');stat_mov_front=0;}else if((getEventProperty('key',event)=='ArrowDown'||getEventProperty('key',event)=='s')&&(stat_view_FPS==1||stat_view_TPS==1)){console.log('Back up!');stat_move_back=0;}else if(getEventProperty('key',event)=='q'&&(stat_view_FPS==1||stat_view_TPS==1)){stat_giro_left=0;}else if(getEventProperty('key',event)=='e'&&(stat_view_FPS==1||stat_view_TPS==1)){stat_giro_right=0;}}});eventHTMLElem('keydown',["BODY"],true,function(event){if(!stat_game_paused&&!stat_game_finised&&start_game){if((getEventProperty('key',event)=='ArrowLeft'||getEventProperty('key',event)=='a')&&(stat_view_FPS==1||stat_view_TPS==1)){console.log('go left!');stat_move_left=1;}else if((getEventProperty('key',event)=='ArrowRight'||getEventProperty('key',event)=='d')&&(stat_view_FPS==1||stat_view_TPS==1)){console.log('go right!');stat_move_right=1;}else if(getEventProperty('key',event)=='Enter'&&(stat_view_FPS==1||stat_view_TPS==1)){if(stat_jump==0){stat_jump=1;}}else if((getEventProperty('key',event)=='w'||getEventProperty('key',event)=='ArrowUp')&&(stat_view_FPS==1||stat_view_TPS==1)){console.log('front');stat_mov_front=1;}else if((getEventProperty('key',event)=='ArrowDown'||getEventProperty('key',event)=='s')&&(stat_view_FPS==1||stat_view_TPS==1)){console.log('Back');stat_move_back=1;}else if(getEventProperty('key',event)=='q'&&(stat_view_FPS==1||stat_view_TPS==1)){console.log('Giro_Left!');stat_giro_left=1;}else if(getEventProperty('key',event)=='e'&&(stat_view_FPS==1||stat_view_TPS==1)){console.log('Giro_Right!');stat_giro_right=1;}}});eventHTMLElem('mousedown','Control_Jump',true,function(event){stat_jump=1;});'ArrowRight';eventHTMLElem('touchstart','Control_Jump',true,function(event){stat_jump=1;});eventHTMLElem('mouseleave','Control_Jump',true,function(event){stat_jump=0;});eventHTMLElem('touchend','Control_Jump',true,function(event){if(!stat_cam_go_down){stat_jump=0;}});eventHTMLElem('mouseleave','Button_Giro_Left',true,function(event){console.log('go giro left!');stat_giro_left=0;});eventHTMLElem('mousedown','Button_Giro_Left',true,function(event){console.log('go giro left!');stat_giro_left=1;});eventHTMLElem('mouseleave','Button_Giro_Right',true,function(event){console.log('go giro right!');stat_giro_right=0;});eventHTMLElem('mousedown','Button_Giro_Right',true,function(event){console.log('go giro right!');stat_giro_right=1;});eventHTMLElem('mouseleave','Button_Left',true,function(event){console.log('go left!');stat_move_left=0;});eventHTMLElem('mousedown','Button_Left',true,function(event){console.log('go left!');stat_move_left=1;});eventHTMLElem('mouseleave','Button_Right',true,function(event){console.log('go right!');stat_move_right=0;});eventHTMLElem('mousedown','Button_Right',true,function(event){console.log('go right!');stat_move_right=1;});eventHTMLElem('mouseleave','Button_Front',true,function(event){console.log('go front');stat_mov_front=0;});eventHTMLElem('mousedown','Button_Front',true,function(event){console.log('go front');stat_mov_front=1;});eventHTMLElem('mouseleave','Button_Back',true,function(event){console.log('go back!');stat_move_back=0;});eventHTMLElem('mousedown','Button_Back',true,function(event){console.log('go back!');stat_move_back=1;});registerInterval(1,function(){if(!stat_game_paused&&time>0){time=time-1;setHTMLElemAttribute('innerHTML',time,'Time',true);}else if(!stat_game_paused&&start_game&&time<=0){game_finised();update_app_vars();}
if(stat_view_TPS==1&&stat_view_FPS==0&&stat_view_orbit==0){setActiveCamera("Cam_down_ctrl");tweenCamera('',"camera_target",1,function(){});show_body_hunter();hide_body_hunter_fps();}else if(stat_view_orbit==1){setActiveCamera("Cam_orbit");tweenCamera('',"camera_target",1,function(){});}
if(stat_change_char){setActiveCamera("camera_low_scene");tweenCamera('',"pivot_change_char",1,function(){});change_char_menu();}
if(stat_cheats_menu){cheats_menu();}
if(stat_change_char){setActiveCamera("camera_low_scene");}
if(stat_view_FPS){setActiveCamera("Cam_firstperson");snapToObject("Cam_firstperson2","Cam_firstperson");}
if(!stat_jump&&stat_view_FPS){current_pos_Z_fps=getObjTransform("Cam_firstperson2","position","y");if(!stat_en_pte&&current_pos_Z_fps>0.48){stat_en_pte=1;cam_pos_z_max=cam_pos_z_min+5;cam_pos_z_min=getObjTransform("Cam_firstperson2","position","y");console.log('creo que deberiamos ver que estamos en pte');}else{stat_en_pte=0;}}});registerEveryFrame(function(){if(!stat_game_paused&&!stat_game_finised&&start_game){char_status();setObjTransform("fondo","rotation",'','',0.03,true);for(j=1;j<=9;j++){emptys_to_check=String('Empty.00')+String(j);if(stat_view_TPS||stat_view_orbit){emptys_distance[j]=getDistanceBetweenObjects("character_picker",emptys_to_check);}else if(stat_view_FPS){emptys_distance[j]=getDistanceBetweenObjects("Cam_firstperson",emptys_to_check);}}
for(j=10;j<=11;j++){emptys_to_check=String('Empty.0')+String(j);if(stat_view_TPS||stat_view_orbit){emptys_distance[j]=getDistanceBetweenObjects("character_picker",emptys_to_check);}else if(stat_view_FPS){emptys_distance[j]=getDistanceBetweenObjects("Cam_firstperson",emptys_to_check);}}}});eventHTMLElem('click','Run_Button',true,function(event){if(stat_view_TPS){stat_game_paused=0;console.log('partimos de paused para que no cuente ');console.log('y aqui iniciamos game');start_game=1;person_position_reset=1;cam_rot_reset=1;reset_rot_character();console.log('Se ha reorientado up el character!');console.log('rotandolo removiendo la fisica');console.log('He descubierto que reset_rot_character');console.log('ya incluye reset camera');person_position_reset=0;hide_run_tool();}});eventHTMLElem('click','Reset_Char',true,function(event){if(stat_view_TPS){person_position_reset=1;cam_rot_reset=1;reset_rot_character();console.log('Se ha reorientado up el character!');console.log('rotandolo removiendo la fisica');console.log('He descubierto que reset_rot_character');console.log('ya incluye reset camera');person_position_reset=0;}});eventHTMLElem('touchstart','Reset_Char',true,function(event){if(stat_view_TPS){person_position_reset=1;cam_rot_reset=1;reset_rot_character();console.log('Se ha reorientado up el character!');console.log('rotandolo removiendo la fisica');console.log('He descubierto que reset_rot_character');console.log('ya incluye reset camera');person_position_reset=0;}});eventHTMLElem('click','Restart_Pos_Char',true,function(event){console.log('Se ha restablecido poscion character!');physicsApplyVector("POSITION","hunter_physic",-1.4,0,0.5);setObjTransform("hunter_physic","rotation",0,0,0,true);});eventHTMLElem('touchstart','Restart_Pos_Char',true,function(event){console.log('Se ha restablecido poscion character!');physicsApplyVector("POSITION","hunter_physic",-1.4,0,0.5);setObjTransform("hunter_physic","rotation",0,0,0,true);});stat_en_pte=0;eventHTMLElem('touchend','Reset_Char',true,function(event){});registerEveryFrame(function(){if(stat_mov_front==0&&stat_move_back==0&&start_game&&isAnimationPlaying("hunter_rig")){operateAnimation("STOP","hunter_rig",null,null,'AUTO',1,function(){},undefined,false);}
if(stat_mov_front==1&&!isAnimationPlaying("hunter_rig")){operateAnimation("PLAY","hunter_rig",null,null,'LoopOnce',1,function(){},undefined,false);}else if(stat_move_back==1&&!isAnimationPlaying("hunter_rig")){operateAnimation("PLAY","hunter_rig",null,null,'LoopOnce',1,function(){},undefined,false);}});eventHTMLElem('touchend','Restart_Pos_Char',true,function(event){});initFullscreen('fullscreen_button',true,function(){setHTMLElemStyle('backgroundImage','media/fullscreen-close.png','fullscreen_button',true);},function(){setHTMLElemStyle('backgroundImage','media/fullscreen-open.png','fullscreen_button',true);},function(){});eventHTMLElem('click','Control_View_FPS',true,function(event){Go_FPS();if(is_selected_char_hunter){hide_body_hunter();}else if(is_selected_char_amazon){hide_body_amazon();}
stat_pt_lock_js=1;console.log('algo esta desactviando pointerlook');console.log('aqui en view seccion icon FPS, TPS gestion');view='FPS';stat_view=stat_view_FPS;getJSFunction('set_stat_view')(stat_view,view);});eventHTMLElem('click','Control_View_TPS',true,function(event){Go_TPS();stat_pt_lock_js=0;console.log('algo esta desactviando pointerlook');console.log('aqui en view seccion icon FPS, TPS gestion');});eventHTMLElem('click','Control_View_Orbit',true,function(event){Go_ORBIT_TPS();stat_pt_lock_js=0;console.log('algo esta desactviando pointerlook');console.log('aqui en view seccion icon FPS, TPS gestion');view='orbit';stat_view=stat_view_orbit;getJSFunction('set_stat_view')(stat_view,view);});eventHTMLElem('click','Control_Out_Vehicle',true,function(event){console.log('salir vehiculo');});eventHTMLElem('touchstart','Control_Out_Vehicle',true,function(event){console.log('salir vehiculo');});eventHTMLElem('touchend','Control_Out_Vehicle',true,function(event){});eventHTMLElem('click','Controls_Touch3',true,function(event){controls_touch3();});stat_show_controls_touch3=0;eventHTMLElem('click','Control_Main_Menu',true,function(event){console.log('menu o enemigos click');});eventHTMLElem('click','Control_Attack',true,function(event){console.log('click attack');});eventHTMLElem('touchstart','Controls_Touch3',true,function(event){controls_touch3();});eventHTMLElem('click','Control_Fly',true,function(event){console.log('fly click');});eventHTMLElem('touchstart','Control_Main_Menu',true,function(event){console.log('menu o enemigos click');});eventHTMLElem('touchstart','Control_Attack',true,function(event){console.log('click attack');});eventHTMLElem('touchstart','Control_Fly',true,function(event){console.log('fly click');});eventHTMLElem('touchend','Control_Fly',true,function(event){});eventHTMLElem('touchend','Control_Main_Menu',true,function(event){});eventHTMLElem('touchend','Control_Attack',true,function(event){});eventHTMLElem('click','Controls_Touch',true,function(event){controls_touch();});stat_show_controls_touch=0;eventHTMLElem('touchstart','Controls_Touch',true,function(event){controls_touch();});stat_show_controls_touch2=0;eventHTMLElem('click','Controls_Touch2',true,function(event){controls_touch2();});stat_show_controls_touch1=0;eventHTMLElem('click','Controls_Touch1',true,function(event){controls_touch1();});eventHTMLElem('touchstart','Controls_Touch2',true,function(event){controls_touch2();});eventHTMLElem('touchstart','Controls_Touch1',true,function(event){controls_touch1();});"Cam_FPS_plock";eventHTMLElem('click','Game_Menu_Calling',true,function(event){game_paused();});eventHTMLElem('click','Menu_Resume',true,function(event){game_resume();});eventHTMLElem('click','Game_Exit',true,function(event){show_game_exit();setHTMLElemStyle('visibility','hidden','Game_Menu',true);setHTMLElemStyle('zIndex','0','Game_Menu',true);});eventHTMLElem('click','Next_Level_Dialeg_Sub',true,function(event){console.log('click al next_level_dialeg');console.log('con un restart accion incluida');hide_repes_finalizat();hide_game_menu_calling();hide_nex_level_btn();game_restart();});eventHTMLElem('click','Game_Exit_Dialeg_Sub',true,function(event){unloadScene('atlantida.gltf');hide_game_exit();hide_repes_no_finalizat();console.log('deberiamos poder abrir una pagina');getJSFunction('game_exit_sub_btn_cb')();});eventHTMLElem('click','Menu_Restart',true,function(event){console.log('clicked al  menu_restart ');hide_repes_no_finalizat();game_restart();setHTMLElemStyle('zIndex','0','Next_Level_Dialeg_Sub',true);setHTMLElemStyle('visibility','hidden','Next_Level_Dialeg_Sub',true);});eventHTMLElem('click','Menu_Character',true,function(event){hide_repes_no_finalizat();show_icon_change_char();scene_main_loaded=0;descarga_current_level_y_character();});eventHTMLElem('click','Game_Restart_Dialeg',true,function(event){console.log('click al  game_restart_dialeg');console.log('en puzzle game menu apartado');hide_repes_finalizat();hide_game_restart();game_restart();});eventHTMLElem('click','Save_Game',true,function(event){save_stat();hide_game_exit();setHTMLElemStyle('visibility','visible','Game_Menu',true);setHTMLElemStyle('zIndex','3','Game_Menu',true);console.log('guardada partida');});scene_main_loaded=1;eventHTMLElem('click','Authors_List_Exit',true,function(event){hide_authors_list();hide_game_credits();console.log('regresamos de credits a game menu');});eventHTMLElem('click','Menu_Cheats_Exit',false,function(event){console.log('esto va dentro un click a 1 btn regresar pendent');stat_cheats_menu=0;stat_show_f02=0;hide_form_f02_Cheats_menu();hide_help_f2();show_game_main();console.log('regresamos de Menu_cheats a game menu');});eventHTMLElem('click','Menu_Credits',true,function(event){show_game_credits();show_authors_list();console.log('credits');});eventHTMLElem('click','Menu_Help',true,function(event){show_game_help();console.log('ayuda');console.log('el idioma es :');console.log(current_lang);});eventHTMLElem('click','Help_Next',true,function(event){console.log('siguiente help');next_help();});eventHTMLElem('click','Help_Exit',true,function(event){console.log('o retrocedemos para ello');if(page_help==5){if(current_lang=='es'){setHTMLElemAttribute('src','interface/help_desk_es_p4.png','Img_Panel',true);}else if(current_lang=='en'){setHTMLElemAttribute('src','interface/help_desk_en_p4.png','Img_Panel',true);}
page_help=(typeof page_help=='number'?page_help:0)+ -1;show_help_next();hide_help_descr();}else if(page_help==4){if(current_lang=='es'){setHTMLElemAttribute('src','interface/help_desk_es_p3.png','Img_Panel',true);}else if(current_lang=='en'){setHTMLElemAttribute('src','interface/help_desk_en_p3.png','Img_Panel',true);}
page_help=(typeof page_help=='number'?page_help:0)+ -1;}else if(page_help==3){if(current_lang=='es'){setHTMLElemAttribute('src','interface/help_desk_es_p2.png','Img_Panel',true);}else if(current_lang=='en'){setHTMLElemAttribute('src','interface/help_desk_en_p2.png','Img_Panel',true);}
page_help=(typeof page_help=='number'?page_help:0)+ -1;}else if(page_help==2){if(current_lang=='es'){setHTMLElemAttribute('src','interface/help_desk_es_p1.png','Img_Panel',true);}else if(current_lang=='en'){setHTMLElemAttribute('src','interface/help_desk_en_p1.png','Img_Panel',true);}
page_help=(typeof page_help=='number'?page_help:0)+ -1;}else if(page_help==1){hide_game_help();console.log('salimos help');}});eventHTMLElem('click','Menu_Cheats(trucos)',true,function(event){stat_cheats_menu=1;stat_show_f02=1;count_cheats_access=(typeof count_cheats_access=='number'?count_cheats_access:0)+1;show_form_f02_Cheats_menu();show_help_f2();hide_game_main();cheats_menu();console.log('cheats o el menu opciones alternativas ej idioma change');if(current_lang=='es'&&!(count_cheats_access==1)){console.log('actualiza su valor en main section con ');console.log('get parameters runcode');setHTMLElemAttribute('checked',0,'F02_Idiome_ES/EN',false);getJSFunction('switch_lang')('en');console.log('supuestametne se da que previ storage clear es 1');}else if(current_lang=='en'&&!(count_cheats_access==1)){setHTMLElemAttribute('checked',1,'F02_Idiome_ES/EN',false);getJSFunction('switch_lang')('es');}
if(stat_previ_storage_clear){console.log('actualiza su valor en main section con ');console.log('get parameters runcode');setHTMLElemAttribute('checked',1,'F02_Anims',false);console.log('supuestametne se da que previ storage clear es 1');}else if(!stat_previ_storage_clear){setHTMLElemAttribute('checked',0,'F02_Anims',false);}});page_help=1;stat_cheats_menu=0;stat_show_f02=0;count_cheats_access=0;stat_clear_storage=0;scene_change_char_loaded=0;registerEveryFrame(function(){if(start_game){for(k=1;k<=9;k++){if(emptys_distance[k]<=0.5&&emptys_witch_fruits[k]!='Empty'){console.log('hay colision');fruit_count(k);}}
for(k=10;k<=11;k++){if(emptys_distance[k]<=0.5&&emptys_witch_fruits[k]!='Empty'){console.log('hay colision');fruit_count(k);}}}});eventHTMLElem('click','Sound_Id',false,function(event){load_scene_change_char();stat_change_char=1;stat_view_FPS=0;stat_view_orbit=0;stat_view_TPS=0;view='change_char';stat_view=stat_change_char;getJSFunction('set_stat_view')(stat_view,view);if(!stat_show_f01){show_form_f01_change_char_menu();show_button_select_avatars();}else if(stat_show_f01){hide_form_f01_change_char_menu();}});eventHTMLElem('click','select_amazon_btn',true,function(event){is_selected_char_amazon=1;clicked_a();});eventHTMLElem('click','select_hunter_btn',true,function(event){is_selected_char_hunter=1;clicked_h();});registerOnClick("select_a",function(){is_selected_char_amazon=1;clicked_a();},function(){});registerOnClick("select_h",function(){is_selected_char_hunter=1;clicked_h();},function(){});eventHTMLElem('click','Control_Save_Current_Stat',false,function(event){save_stat();});5;0.3;}
if(window.v3dApp){PL.legacyMode=true;PL.init(window.v3dApp);}})();